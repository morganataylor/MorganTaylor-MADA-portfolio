<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Tidy Tuesday Exercise (Module 13)</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="./aboutme.html">About Me</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    MADA Exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="./rcoding.html">R Coding</a>
    </li>
    <li>
      <a href="./visualization.html">Visualization</a>
    </li>
    <li>
      <a href="./tidytuesday_exercise.html">Tidy Tuesday Exercise #1</a>
    </li>
    <li>
      <a href="./tidytuesday_exercise2.html">Tidy Tuesday Exercise #2</a>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Influenza Analysis Project</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="./flu_analysis_proj.html">Introduction</a>
        </li>
        <li>
          <a href="./processing.html">Data Processing</a>
        </li>
        <li>
          <a href="./exploratory_analysis.html">Exploratory Data Analysis</a>
        </li>
        <li>
          <a href="./tidymodels_1.html">TidyModels Analysis Part 1</a>
        </li>
        <li>
          <a href="./tidymodels_2.html">TidyModels Analysis Part 2</a>
        </li>
        <li>
          <a href="./ml_analysis.html">Machine Learning Analysis</a>
        </li>
      </ul>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/morganataylor/MorganTaylor-MADA-portfolio">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Tidy Tuesday Exercise (Module 13)</h1>

</div>


<p><br></p>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The following exercise is for <a href="https://andreashandel.github.io/MADAcourse/Assessment_Complete_Workflow.html">Module 13 in Dr. Andreas Handel’s MADA Course</a>. We are using the <a href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-06-02/">Marble Racing dataset</a>, which is a previous TidyTuesday dataset from the week of 06/02/2020.</p>
<hr />
<p>This analysis will follow these steps:</p>
<ol style="list-style-type: decimal">
<li>Load, wrangle, and explore the data.</li>
<li>Formulate a question / hypothesis, and determine outcome (and predictors as applicable) of interest.</li>
<li>Further data processing and cleaning.</li>
<li>Split data into train / test subsets.</li>
<li>Fit at least 4 different ML models to the data using the <code>tidymodels</code> framework.</li>
<li>Choose the overall best model.</li>
<li>Evaluate the chosen model on the test data.</li>
<li>Discussion summary.</li>
</ol>
<hr />
<p>This analysis fits the following models to the outcome of interest:</p>
<ul>
<li>Null Model</li>
<li>Decision Tree</li>
<li>Random Forest</li>
<li>Bagged Tree</li>
<li>LASSO</li>
</ul>
<hr />
<p>Each machine learning model will follow this process:</p>
<ol style="list-style-type: decimal">
<li>Model Specification</li>
<li>Workflow Definition</li>
<li>Tuning Grid Specification</li>
<li>Tuning Using Cross-Validation and the <code>tune_grid()</code> function</li>
<li>Identify Best Model</li>
<li>Model Evaluation</li>
</ol>
<hr />
<p>A few comments about notation and documentation throughout this markdown:</p>
<ul>
<li>each iteration of data processing will be called <code>marbles_#</code></li>
<li>the final processed dataset will be saved as <code>marbles_processed</code> in the <code>data</code> folder in the GitHub repository for this website</li>
</ul>
<p><br></p>
<p>Let’s get started!</p>
<hr />
</div>
<div id="required-packages" class="section level2">
<h2>Required Packages</h2>
<p>The following R packages are required for this analysis: ## Required Packages The following R packages are required for this exercise:</p>
<ul>
<li>here: for data loading/saving</li>
<li>summarytools: for overall dataframe summaries</li>
<li>skimr: for variable summaries</li>
<li>tidyverse: for data management</li>
<li>lubridate: for wrangling date variables</li>
<li>ggplot2: for plotting data</li>
<li>RColorBrewer: for coloring the plots</li>
<li>ggbump: for creating bump plots</li>
<li>tidymodels: for data modeling</li>
<li>broom.mixed: for converting bayesian models to tidy tibbles</li>
<li>rpart.plot: for visualizing a decision tree</li>
<li>vip: for variable importance plots</li>
<li>glmnet: for lasso models</li>
<li>doParallel: for parallel backend for tuning processes</li>
<li>ranger: for random forest models</li>
</ul>
<hr />
</div>
<div id="load-data" class="section level2">
<h2>Load Data</h2>
<p>The code to load the data is referenced in the GitHub repository linked above. It is also stored in the <code>data</code> folder in the GitHub repository for this website (linked in the top right corner of the page).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#using the website link</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>marbles <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-02/marbles.csv&#39;</span>)</span></code></pre></div>
<pre><code>## Rows: 256 Columns: 14</code></pre>
<pre><code>## -- Column specification --------------------------------------------------------
## Delimiter: &quot;,&quot;
## chr (9): date, race, site, source, marble_name, team_name, pole, host, notes
## dbl (5): time_s, points, track_length_m, number_laps, avg_time_lap</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#save the raw csv to the `data` folder</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>raw_data_location <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;tidytuesday2&quot;</span>, <span class="st">&quot;marbles_raw.csv&quot;</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>marbles_raw <span class="ot">&lt;-</span> utils<span class="sc">::</span><span class="fu">write.csv</span>(marbles, raw_data_location)</span></code></pre></div>
<hr />
</div>
<div id="data-background" class="section level2">
<h2>Data Background</h2>
<p>From the <a href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-06-02/readme.md">readme.md on GitHub</a>, this week’s data comes from <a href="http://www.randalolson.com/2020/05/24/a-data-driven-look-at-marble-racing/">Randy Olson’s compilation</a> of <a href="https://www.youtube.com/channel/UCYJdpnjuSWVOLgGT9fIzL0g">Jelle’s Marble Runs</a>.</p>
<p>The description of the data from Randy Olson’s blogpost is as follows: &gt;“Jelle’s Marble Runs started as a quirky YouTube channel back in 2006 and has refined the art of marble racing to the point that many — including sponsor John Oliver from Last Week Tonight — consider marble racing a legitimate contender for the national sports spotlight. Given that Jelle’s Marble Runs just completed their popular Marbula One competition last month, I was curious to look at the race results to see if these races were anything more than chaos. &gt; &gt;Do some marbles race better than others? Who would I put my money on in season 2 of Marbula One? … If any of these questions interest you, read on and I’ll answer some of them. &gt; &gt;The first step to answering these questions was to get some data. Thankfully, all of the Marbula One videos are organized in a YouTube playlist available here. From every race, my marble racing analytics team recorded each marble racer’s qualifier performance, total race time, average lap time, final rank, and some other statistics. That dataset is available for download on my website here.”</p>
<p>The data dictionary is described in the readme.md in the repository, but is also replicated below for reference in the analysis.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create data dictionary dataframe</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;race&quot;</span>, <span class="st">&quot;site&quot;</span>, <span class="st">&quot;source&quot;</span>, <span class="st">&quot;marble_name&quot;</span>, <span class="st">&quot;team_name&quot;</span>, <span class="st">&quot;time_s&quot;</span>, <span class="st">&quot;pole&quot;</span>, <span class="st">&quot;points&quot;</span>, <span class="st">&quot;track_length_m&quot;</span>, <span class="st">&quot;number_laps&quot;</span>, <span class="st">&quot;avg_time_lap&quot;</span>, <span class="st">&quot;host&quot;</span>, <span class="st">&quot;notes&quot;</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>class <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;character&quot;</span>, <span class="st">&quot;character&quot;</span>, <span class="st">&quot;character&quot;</span>, <span class="st">&quot;character&quot;</span>, <span class="st">&quot;character&quot;</span>, <span class="st">&quot;character&quot;</span>, <span class="st">&quot;double&quot;</span>, <span class="st">&quot;character&quot;</span>, <span class="st">&quot;double&quot;</span>, <span class="st">&quot;double&quot;</span>, <span class="st">&quot;double&quot;</span>, <span class="st">&quot;double&quot;</span>, <span class="st">&quot;character&quot;</span>, <span class="st">&quot;character&quot;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>description <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;date of race&quot;</span>, <span class="st">&quot;race id&quot;</span>, <span class="st">&quot;site of race&quot;</span>, <span class="st">&quot;youtube url&quot;</span>, <span class="st">&quot;name of marble&quot;</span>, <span class="st">&quot;team name&quot;</span>, <span class="st">&quot;time in seconds&quot;</span>, <span class="st">&quot;pole position&quot;</span>, <span class="st">&quot;points gained&quot;</span>, <span class="st">&quot;track length in meters&quot;</span>, <span class="st">&quot;number of laps&quot;</span>, <span class="st">&quot;average lap time&quot;</span>, <span class="st">&quot;host of race&quot;</span>, <span class="st">&quot;notes (very few, but some notes about potential errors&quot;</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>data_dictionary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(variable, class, description)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data_dictionary)</span></code></pre></div>
<pre><code>##          variable     class
## 1            date character
## 2            race character
## 3            site character
## 4          source character
## 5     marble_name character
## 6       team_name character
## 7          time_s    double
## 8            pole character
## 9          points    double
## 10 track_length_m    double
## 11    number_laps    double
## 12   avg_time_lap    double
## 13           host character
## 14          notes character
##                                               description
## 1                                            date of race
## 2                                                 race id
## 3                                            site of race
## 4                                             youtube url
## 5                                          name of marble
## 6                                               team name
## 7                                         time in seconds
## 8                                           pole position
## 9                                           points gained
## 10                                 track length in meters
## 11                                         number of laps
## 12                                       average lap time
## 13                                           host of race
## 14 notes (very few, but some notes about potential errors</code></pre>
<p>I wanted to better understand the pole position and points gained variables, as I assumed they are unique to the sport of marble racing.</p>
<p>After some digging on the <a href="https://jellesmarbleruns.fandom.com/wiki/Marbula_One#Points_System">Jelle’s Marble Runs Fandom WikiPage</a>, the points system for season 1 is designed to be identical to Formula One racing:</p>
<ul>
<li>1st place: 25 points</li>
<li>2nd place: 18 points</li>
<li>3rd place: 15 points</li>
<li>4th place: 12 points</li>
<li>5th place: 10 points</li>
<li>6th place: 8 points</li>
<li>7th place: 6 points</li>
<li>8th place: 4 points</li>
<li>9th place: 2 points</li>
<li>10th place: 1 point</li>
<li>11th through 16th place: 0 points</li>
<li>Did not finish: 0 points</li>
<li>The marble who completes the course with the fastest time: 1 bonus point</li>
</ul>
<p>Just in case we need it later, let’s create a dataframe for points definitions.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>value <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">18</span>, <span class="dv">15</span>, <span class="dv">12</span>, <span class="dv">10</span>, <span class="dv">8</span>, <span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>place <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1st&quot;</span>, <span class="st">&quot;2nd&quot;</span>, <span class="st">&quot;3rd&quot;</span>, <span class="st">&quot;4th&quot;</span>, <span class="st">&quot;5th&quot;</span>, <span class="st">&quot;6th&quot;</span>, <span class="st">&quot;7th&quot;</span>, <span class="st">&quot;8th&quot;</span>, <span class="st">&quot;9th&quot;</span>, <span class="st">&quot;10th&quot;</span>, <span class="st">&quot;11th&quot;</span>, <span class="st">&quot;12th&quot;</span>, <span class="st">&quot;13th&quot;</span>, <span class="st">&quot;14th&quot;</span>, <span class="st">&quot;15th&quot;</span>, <span class="st">&quot;16th&quot;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>points_dictionary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(value, place)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(points_dictionary)</span></code></pre></div>
<pre><code>##    value place
## 1     25   1st
## 2     18   2nd
## 3     15   3rd
## 4     12   4th
## 5     10   5th
## 6      8   6th
## 7      6   7th
## 8      4   8th
## 9      2   9th
## 10     1  10th
## 11     0  11th
## 12     0  12th
## 13     0  13th
## 14     0  14th
## 15     0  15th
## 16     0  16th</code></pre>
<p>In motorsports, the pole position is the position at the front at the start of a racing event. That position is typically given to the vehicle and driver with the best qualifying time in the trials before the race. In this dataset, the <code>pole</code> variable appears to correspond to the positioning at the beginning of the race.</p>
<hr />
</div>
<div id="data-overview" class="section level2">
<h2>Data Overview</h2>
<p>Take an initial look at the raw data. Start by using <code>utils::str()</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#data structure</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>utils<span class="sc">::</span><span class="fu">str</span>(marbles)</span></code></pre></div>
<pre><code>## spec_tbl_df [256 x 14] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
##  $ date          : chr [1:256] &quot;15-Feb-20&quot; &quot;15-Feb-20&quot; &quot;15-Feb-20&quot; &quot;15-Feb-20&quot; ...
##  $ race          : chr [1:256] &quot;S1Q1&quot; &quot;S1Q1&quot; &quot;S1Q1&quot; &quot;S1Q1&quot; ...
##  $ site          : chr [1:256] &quot;Savage Speedway&quot; &quot;Savage Speedway&quot; &quot;Savage Speedway&quot; &quot;Savage Speedway&quot; ...
##  $ source        : chr [1:256] &quot;https://youtu.be/JtsQ_UydjEI?t=356&quot; &quot;https://youtu.be/JtsQ_UydjEI?t=356&quot; &quot;https://youtu.be/JtsQ_UydjEI?t=356&quot; &quot;https://youtu.be/JtsQ_UydjEI?t=356&quot; ...
##  $ marble_name   : chr [1:256] &quot;Clementin&quot; &quot;Starry&quot; &quot;Momo&quot; &quot;Yellow&quot; ...
##  $ team_name     : chr [1:256] &quot;O&#39;rangers&quot; &quot;Team Galactic&quot; &quot;Team Momo&quot; &quot;Mellow Yellow&quot; ...
##  $ time_s        : num [1:256] 28.1 28.4 28.4 28.7 28.7 ...
##  $ pole          : chr [1:256] &quot;P1&quot; &quot;P2&quot; &quot;P3&quot; &quot;P4&quot; ...
##  $ points        : num [1:256] NA NA NA NA NA NA NA NA NA NA ...
##  $ track_length_m: num [1:256] 12.8 12.8 12.8 12.8 12.8 ...
##  $ number_laps   : num [1:256] 1 1 1 1 1 1 1 1 1 1 ...
##  $ avg_time_lap  : num [1:256] 28.1 28.4 28.4 28.7 28.7 ...
##  $ host          : chr [1:256] &quot;No&quot; &quot;No&quot; &quot;No&quot; &quot;No&quot; ...
##  $ notes         : chr [1:256] NA NA NA NA ...
##  - attr(*, &quot;spec&quot;)=
##   .. cols(
##   ..   date = col_character(),
##   ..   race = col_character(),
##   ..   site = col_character(),
##   ..   source = col_character(),
##   ..   marble_name = col_character(),
##   ..   team_name = col_character(),
##   ..   time_s = col_double(),
##   ..   pole = col_character(),
##   ..   points = col_double(),
##   ..   track_length_m = col_double(),
##   ..   number_laps = col_double(),
##   ..   avg_time_lap = col_double(),
##   ..   host = col_character(),
##   ..   notes = col_character()
##   .. )
##  - attr(*, &quot;problems&quot;)=&lt;externalptr&gt;</code></pre>
<p>This confirms imported data classes are correct and match the data dictionary.</p>
<p><br></p>
<p>Now use base R function <code>summary()</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#data summary</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(marbles)</span></code></pre></div>
<pre><code>##      date               race               site              source         
##  Length:256         Length:256         Length:256         Length:256        
##  Class :character   Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character   Mode  :character  
##                                                                             
##                                                                             
##                                                                             
##                                                                             
##  marble_name         team_name             time_s           pole          
##  Length:256         Length:256         Min.   : 17.76   Length:256        
##  Class :character   Class :character   1st Qu.: 28.40   Class :character  
##  Mode  :character   Mode  :character   Median : 36.28   Mode  :character  
##                                        Mean   :190.84                     
##                                        3rd Qu.:338.16                     
##                                        Max.   :492.01                     
##                                        NA&#39;s   :3                          
##      points       track_length_m   number_laps     avg_time_lap  
##  Min.   : 0.000   Min.   :11.90   Min.   : 1.00   Min.   :17.76  
##  1st Qu.: 0.000   1st Qu.:12.62   1st Qu.: 1.00   1st Qu.:25.94  
##  Median : 3.000   Median :13.02   Median : 5.00   Median :30.05  
##  Mean   : 6.453   Mean   :13.22   Mean   : 6.25   Mean   :29.70  
##  3rd Qu.:11.250   3rd Qu.:14.13   3rd Qu.:10.25   3rd Qu.:33.65  
##  Max.   :26.000   Max.   :14.55   Max.   :16.00   Max.   :41.62  
##  NA&#39;s   :128                                      NA&#39;s   :3      
##      host              notes          
##  Length:256         Length:256        
##  Class :character   Class :character  
##  Mode  :character   Mode  :character  
##                                       
##                                       
##                                       
## </code></pre>
<p>There are 128 NAs in points, 3 NAs in avg_time_lap. Perhaps the NAs in avg_time_lap correspond to those that didn’t finish the race? In this output, we can’t see any information about the character variables.</p>
<p><br></p>
<p>Now use <code>skim</code> as it lets us see the distribution of variables.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#data summary</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(marbles)</span></code></pre></div>
<table style="width: auto;" class="table table-condensed">
<caption>
Data summary
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
marbles
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
256
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
14
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
min
</th>
<th style="text-align:right;">
max
</th>
<th style="text-align:right;">
empty
</th>
<th style="text-align:right;">
n_unique
</th>
<th style="text-align:right;">
whitespace
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
date
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
race
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
site
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
source
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
34
</td>
<td style="text-align:right;">
34
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
marble_name
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
32
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
team_name
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
pole
</td>
<td style="text-align:right;">
128
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
host
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
notes
</td>
<td style="text-align:right;">
249
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
37
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:left;">
hist
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
time_s
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:right;">
190.84
</td>
<td style="text-align:right;">
169.13
</td>
<td style="text-align:right;">
17.76
</td>
<td style="text-align:right;">
28.40
</td>
<td style="text-align:right;">
36.28
</td>
<td style="text-align:right;">
338.16
</td>
<td style="text-align:right;">
492.01
</td>
<td style="text-align:left;">
&lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2587&gt;&lt;U+2581&gt;
</td>
</tr>
<tr>
<td style="text-align:left;">
points
</td>
<td style="text-align:right;">
128
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
6.45
</td>
<td style="text-align:right;">
7.74
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
3.00
</td>
<td style="text-align:right;">
11.25
</td>
<td style="text-align:right;">
26.00
</td>
<td style="text-align:left;">
&lt;U+2587&gt;&lt;U+2582&gt;&lt;U+2582&gt;&lt;U+2581&gt;&lt;U+2581&gt;
</td>
</tr>
<tr>
<td style="text-align:left;">
track_length_m
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
13.22
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
11.90
</td>
<td style="text-align:right;">
12.62
</td>
<td style="text-align:right;">
13.02
</td>
<td style="text-align:right;">
14.13
</td>
<td style="text-align:right;">
14.55
</td>
<td style="text-align:left;">
&lt;U+2585&gt;&lt;U+2585&gt;&lt;U+2582&gt;&lt;U+2581&gt;&lt;U+2587&gt;
</td>
</tr>
<tr>
<td style="text-align:left;">
number_laps
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
6.25
</td>
<td style="text-align:right;">
5.53
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
5.00
</td>
<td style="text-align:right;">
10.25
</td>
<td style="text-align:right;">
16.00
</td>
<td style="text-align:left;">
&lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2583&gt;&lt;U+2582&gt;&lt;U+2582&gt;
</td>
</tr>
<tr>
<td style="text-align:left;">
avg_time_lap
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:right;">
29.70
</td>
<td style="text-align:right;">
5.55
</td>
<td style="text-align:right;">
17.76
</td>
<td style="text-align:right;">
25.94
</td>
<td style="text-align:right;">
30.05
</td>
<td style="text-align:right;">
33.65
</td>
<td style="text-align:right;">
41.62
</td>
<td style="text-align:left;">
&lt;U+2583&gt;&lt;U+2586&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2582&gt;
</td>
</tr>
</tbody>
</table>
<p>A few conclusions from this output:</p>
<ul>
<li>Each date and each race number are repeated 16 times.</li>
<li>To that end, each race site is repeated twice, for a total of 8 sites.</li>
<li>There are 32 marble names, each repeated 8 times.</li>
<li>There are 16 teams, each repeated 16 times.</li>
<li>There are 3 NA’s for time of race and average lap time – we will need to investigate why they’re missing (perhaps because they didn’t finish the race?)</li>
<li>There are 16 values of pole position, which suggests 16 marbles competed in each race.</li>
<li>The 50% missing rate for <code>pole</code> and <code>points</code> suggests that there are two rows for each race (opportunity to concatenate the rows)</li>
<li>Each track length is repeated 32 times, with 8 unique variables.</li>
<li>Number of laps ranges from 1 to 16.</li>
<li>The average lap time seems relatively normally distributed.</li>
<li>There are 16 hosts.</li>
<li>There are 7 notes that will require investigation during the cleaning process.</li>
</ul>
<p>All of this information together suggests there were 16 teams competing in 8 races for Season 1 of Marbula One. Each race was held at a different track, and there was a host team for each race. The first date for each race is the qualifying race date, and the second date is the actual race.</p>
<hr />
</div>
<div id="data-cleaning" class="section level2">
<h2>Data Cleaning</h2>
<p>Based on the examination of the data so far, there are a few immediately obvious steps for cleaning the data:</p>
<ol style="list-style-type: decimal">
<li>Create new variables for qualifying vs race times and average lap times.</li>
<li>Investigate the 7 values of the <code>notes</code> variable.</li>
<li>Replace <code>race</code> and <code>date</code> variable with a new <code>race_number</code> variable.</li>
<li>Drop meaningless variables (e.g. <code>source</code>, <code>notes</code>, <code>avg_lap_time</code>, <code>time_s</code>).</li>
<li>Concatenate the values of qualifying and actual race variables, so that there is only one row for each race and team combination.</li>
</ol>
<p><br></p>
<p>Let’s start with step #1: create new variables to specify race vs qualifying times. There are a number of ways to do this, but I’m going to use the fact that <code>pole</code> is NA for actual races and <code>points</code> is NA for qualifying races.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create shadow df to not manipulate the raw df</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>marbles_1 <span class="ot">&lt;-</span> marbles</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#for race time in seconds</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>marbles_1<span class="sc">$</span>qual_time <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(marbles_1<span class="sc">$</span>points), marbles_1<span class="sc">$</span>time_s, <span class="cn">NA</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>marbles_1<span class="sc">$</span>race_time <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(marbles_1<span class="sc">$</span>pole), marbles_1<span class="sc">$</span>time_s, <span class="cn">NA</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#for average lap length</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>marbles_1<span class="sc">$</span>qual_avg_lap <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(marbles_1<span class="sc">$</span>points), marbles_1<span class="sc">$</span>avg_time_lap, <span class="cn">NA</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>marbles_1<span class="sc">$</span>race_avg_lap <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(marbles_1<span class="sc">$</span>pole), marbles_1<span class="sc">$</span>avg_time_lap, <span class="cn">NA</span>)</span></code></pre></div>
<p><br></p>
<p>Moving onto step #2: investigate the 7 <code>notes</code> values.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#print the notes</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>marbles_1<span class="sc">$</span>notes[<span class="sc">!</span><span class="fu">is.na</span>(marbles_1<span class="sc">$</span>notes)]</span></code></pre></div>
<pre><code>## [1] &quot;Note: Came to complete stop in Lap 14&quot;                                                               
## [2] &quot;*Note: A yellow SAFETY flag is issued due to incident in Lap 1.&quot;                                     
## [3] &quot;Shortly after, a red SUSPENDED flag is issued to restart the race, due to major blockage.&quot;           
## [4] &quot;**Note: Upon the restart, another red flag is issued due to a track invasion incident by a rowdy fan&quot;
## [5] &quot;Race resumed normally after the culprit is escorted by security marbles&quot;                             
## [6] &quot;*Note: Slight incident between Speedy and Clementin&quot;                                                 
## [7] &quot;Ultimately, JMRC reviews and deems no action is necessary&quot;</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#are they associated with different races / teams?</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>marbles_1[<span class="sc">!</span>(<span class="fu">is.na</span>(marbles_1<span class="sc">$</span>notes)), ]</span></code></pre></div>
<pre><code>## # A tibble: 7 x 18
##   date      race  site          source marble_name team_name time_s pole  points
##   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1 22-Mar-20 S1R6  Short Circuit https~ Sublime     Limers      NA   &lt;NA&gt;       0
## 2 29-Mar-20 S1R7  Razzway       https~ Smoggy      Hazers     331.  &lt;NA&gt;      25
## 3 29-Mar-20 S1R7  Razzway       https~ Orangin     O&#39;rangers  332.  &lt;NA&gt;      19
## 4 29-Mar-20 S1R7  Razzway       https~ Anarchy     Balls of~  334.  &lt;NA&gt;      10
## 5 29-Mar-20 S1R7  Razzway       https~ Rapidly     Savage S~  336.  &lt;NA&gt;       6
## 6 4-Apr-20  S1Q8  Midnight Bay  https~ Speedy      Savage S~   24.5 P1        NA
## 7 4-Apr-20  S1Q8  Midnight Bay  https~ Clutter     Balls of~   25.2 P3        NA
## # ... with 9 more variables: track_length_m &lt;dbl&gt;, number_laps &lt;dbl&gt;,
## #   avg_time_lap &lt;dbl&gt;, host &lt;chr&gt;, notes &lt;chr&gt;, qual_time &lt;dbl&gt;,
## #   race_time &lt;dbl&gt;, qual_avg_lap &lt;dbl&gt;, race_avg_lap &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#since each note represents a different race / team, we can leave the notes and let them be combined</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># I prefer to keep the notes in case we need to explain any anomalies in the data</span></span></code></pre></div>
<p><br></p>
<p>Next, step 3: Replace <code>race</code> and <code>date</code> variable with a new <code>race_number</code> variable. We can do this by extracting the 4th character in the <code>race</code> variable, which will tell us the race number.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#just using base R `substr` function to specify finding the 4th value and then selecting the 4th value</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>marbles_1<span class="sc">$</span>race_number <span class="ot">&lt;-</span> <span class="fu">substr</span>(marbles_1<span class="sc">$</span>race, <span class="dv">4</span>, <span class="dv">4</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>marbles_2 <span class="ot">&lt;-</span> marbles_1 <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(date, race, source, time_s, avg_time_lap))</span></code></pre></div>
<p><br></p>
<p>Moving onto step 4: drop irrelevant variables. This is to avoid confusing R when we collapse the rows.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#drop date, race, source, time_s, avg_time_lap</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>marbles_2 <span class="ot">&lt;-</span> marbles_1 <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(date, race, source, time_s, avg_time_lap))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#reorder columns</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>marbles_3 <span class="ot">&lt;-</span> marbles_2[, <span class="fu">c</span>(<span class="dv">14</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">4</span>, <span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">5</span>, <span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">9</span>)]</span></code></pre></div>
<p><br></p>
<p>The big step, #5: combine all the rows such that there is only one row per race / team.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create filtered subset for qualifying data</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>marbles_4 <span class="ot">&lt;-</span> marbles_3 <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(points, race_time, race_avg_lap)) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(pole)) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">notes_1 =</span> notes)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">#create filtered subset for race data</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>marbles_5 <span class="ot">&lt;-</span> marbles_3 <span class="sc">%&gt;%</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(pole, qual_time, qual_avg_lap)) <span class="sc">%&gt;%</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(points)) <span class="sc">%&gt;%</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">notes_2 =</span> notes)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co">#bind the columns</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>marbles_6 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(marbles_4, marbles_5)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">#remove duplicate columns</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>marbles_7 <span class="ot">&lt;-</span> marbles_6 <span class="sc">%&gt;%</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>))</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="co">#combine notes columns</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>marbles_8 <span class="ot">&lt;-</span> marbles_7 <span class="sc">%&gt;%</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">notes =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(notes_1, notes_2)) <span class="sc">%&gt;%</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(notes_1, notes_2))</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co">#reorder columns</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>marbles_9 <span class="ot">&lt;-</span> marbles_8[, <span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">11</span>, <span class="dv">14</span>)]</span></code></pre></div>
<p>We now have a cleaned dataset that has one row per race/team and includes information about qualifying and actual races. Let’s look at the dataframe summary.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(marbles_9)</span></code></pre></div>
<table style="width: auto;" class="table table-condensed">
<caption>
Data summary
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
marbles_9
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
128
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
14
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
min
</th>
<th style="text-align:right;">
max
</th>
<th style="text-align:right;">
empty
</th>
<th style="text-align:right;">
n_unique
</th>
<th style="text-align:right;">
whitespace
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
race_number
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
site
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
marble_name
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
32
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
team_name
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
host
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
pole
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
notes
</td>
<td style="text-align:right;">
121
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
37
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:left;">
hist
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
track_length_m
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
13.22
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
11.90
</td>
<td style="text-align:right;">
12.62
</td>
<td style="text-align:right;">
13.02
</td>
<td style="text-align:right;">
14.13
</td>
<td style="text-align:right;">
14.55
</td>
<td style="text-align:left;">
&lt;U+2585&gt;&lt;U+2585&gt;&lt;U+2582&gt;&lt;U+2581&gt;&lt;U+2587&gt;
</td>
</tr>
<tr>
<td style="text-align:left;">
number_laps
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
11.50
</td>
<td style="text-align:right;">
2.41
</td>
<td style="text-align:right;">
9.00
</td>
<td style="text-align:right;">
9.75
</td>
<td style="text-align:right;">
10.50
</td>
<td style="text-align:right;">
13.25
</td>
<td style="text-align:right;">
16.00
</td>
<td style="text-align:left;">
&lt;U+2587&gt;&lt;U+2582&gt;&lt;U+2582&gt;&lt;U+2582&gt;&lt;U+2582&gt;
</td>
</tr>
<tr>
<td style="text-align:left;">
qual_time
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
27.52
</td>
<td style="text-align:right;">
5.16
</td>
<td style="text-align:right;">
17.76
</td>
<td style="text-align:right;">
23.93
</td>
<td style="text-align:right;">
28.55
</td>
<td style="text-align:right;">
31.00
</td>
<td style="text-align:right;">
39.49
</td>
<td style="text-align:left;">
&lt;U+2585&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2585&gt;&lt;U+2582&gt;
</td>
</tr>
<tr>
<td style="text-align:left;">
qual_avg_lap
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
27.52
</td>
<td style="text-align:right;">
5.16
</td>
<td style="text-align:right;">
17.76
</td>
<td style="text-align:right;">
23.93
</td>
<td style="text-align:right;">
28.55
</td>
<td style="text-align:right;">
31.00
</td>
<td style="text-align:right;">
39.49
</td>
<td style="text-align:left;">
&lt;U+2585&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2585&gt;&lt;U+2582&gt;
</td>
</tr>
<tr>
<td style="text-align:left;">
race_time
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.98
</td>
<td style="text-align:right;">
358.08
</td>
<td style="text-align:right;">
48.77
</td>
<td style="text-align:right;">
317.73
</td>
<td style="text-align:right;">
333.06
</td>
<td style="text-align:right;">
338.23
</td>
<td style="text-align:right;">
360.16
</td>
<td style="text-align:right;">
492.01
</td>
<td style="text-align:left;">
&lt;U+2587&gt;&lt;U+2582&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2582&gt;
</td>
</tr>
<tr>
<td style="text-align:left;">
race_avg_lap
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.98
</td>
<td style="text-align:right;">
31.92
</td>
<td style="text-align:right;">
5.03
</td>
<td style="text-align:right;">
23.39
</td>
<td style="text-align:right;">
29.66
</td>
<td style="text-align:right;">
32.44
</td>
<td style="text-align:right;">
34.48
</td>
<td style="text-align:right;">
41.62
</td>
<td style="text-align:left;">
&lt;U+2586&gt;&lt;U+2585&gt;&lt;U+2587&gt;&lt;U+2583&gt;&lt;U+2583&gt;
</td>
</tr>
<tr>
<td style="text-align:left;">
points
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
6.45
</td>
<td style="text-align:right;">
7.74
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
3.00
</td>
<td style="text-align:right;">
11.25
</td>
<td style="text-align:right;">
26.00
</td>
<td style="text-align:left;">
&lt;U+2587&gt;&lt;U+2582&gt;&lt;U+2582&gt;&lt;U+2581&gt;&lt;U+2581&gt;
</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="feature-engineering" class="section level2">
<h2>Feature Engineering</h2>
<p>There are a few variables that might be interesting to create based on the data:</p>
<ol style="list-style-type: decimal">
<li>Total points for the season for each team</li>
<li>Final placement ranking for the season for each team</li>
<li>The number of times in the season a bonus point was awarded for fastest lap for each team</li>
<li>The cumulative points throughout the season for each team</li>
<li>Ranking throughout the season for each team</li>
<li>Difference in time between qualifying and actual races.</li>
<li>Average marble speed during the race.</li>
</ol>
<p>For the season-long characteristics, I’m going to create a new season summary dataframe, and then I will merge it back into the original dataframe at the end of this section.</p>
<p><br></p>
<p>Let’s start with #1: find total points for the season for each team.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#sum the points by team_name</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>season_stats <span class="ot">&lt;-</span> marbles_9 <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(points)) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">group_by</span>(team_name) <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_points =</span> <span class="fu">sum</span>(points))</span></code></pre></div>
<p><br></p>
<p>Next, step #2: final season rankings</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create a variable that is the rank order of the total_points variable</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>season_stats_1 <span class="ot">&lt;-</span> season_stats <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">team_rank =</span> <span class="fu">rank</span>(<span class="fu">desc</span>(total_points),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">ties.method =</span> <span class="st">&quot;min&quot;</span>))</span></code></pre></div>
<p><br></p>
<p>Moving onto #3, finding the number of times a team had the fastest lap in a season</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#count number of each times each points value occurs for each team</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>fastest_lap_counts <span class="ot">&lt;-</span> marbles_9 <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                        dplyr<span class="sc">::</span><span class="fu">count</span>(team_name, points)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">#filter out the values that do not match the points dictionary</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">#count the number of times each time occurs in the filtered list</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>fastest_lap_counts_1 <span class="ot">&lt;-</span> fastest_lap_counts <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                          dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>(points <span class="sc">%in%</span> points_dictionary<span class="sc">$</span>value)) <span class="sc">%&gt;%</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>                          dplyr<span class="sc">::</span><span class="fu">count</span>(team_name)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">#merge into season stats df</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>season_stats_2 <span class="ot">&lt;-</span> <span class="fu">merge</span>(season_stats_1, fastest_lap_counts_1, <span class="at">all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co">#replace NA with 0</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>season_stats_2[<span class="fu">is.na</span>(season_stats_2)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co">#relabel n</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(season_stats_2)[<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="st">&quot;fastest_lap_count&quot;</span></span></code></pre></div>
<p><br></p>
<p>Now we need to combine the <code>season_stats</code> dataframe into the <code>marbles_9</code> dataframe.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>marbles_10 <span class="ot">&lt;-</span> <span class="fu">merge</span>(marbles_9, season_stats_2)</span></code></pre></div>
<p><br></p>
<p>Next, #4, let’s calculate the current total number of points at the beginning of each race. In other words, finding the cumulative points throughout the season.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#fix class of race_number</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(marbles_10<span class="sc">$</span>race_number)</span></code></pre></div>
<pre><code>##   [1] 2 7 6 1 3 4 8 5 7 4 2 6 5 1 3 8 7 5 1 6 8 2 4 3 6 8 7 4 2 1 3 5 6 5 3 1 4
##  [38] 2 7 8 8 4 3 5 2 7 6 1 7 2 5 4 6 3 8 1 2 1 4 5 3 8 6 7 4 6 7 5 1 2 3 8 3 2
##  [75] 8 7 5 6 4 1 6 5 3 1 2 7 8 4 6 5 1 7 8 4 3 2 1 2 8 7 4 5 6 3 4 3 7 2 8 6 5
## [112] 1 2 1 6 7 3 8 4 5 8 6 4 3 1 5 7 2</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#I have no idea why this works but it does</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>marbles_11 <span class="ot">&lt;-</span> marbles_10 <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">group_by</span>(race_number, team_name) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">arrange</span>(race_number, team_name) <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">cumsum =</span> <span class="fu">cumsum</span>(points)) <span class="sc">%&gt;%</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">group_by</span>(team_name) <span class="sc">%&gt;%</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">current_points =</span> <span class="fu">cumsum</span>(cumsum)) <span class="sc">%&gt;%</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>cumsum)</span></code></pre></div>
<p><br></p>
<p>Moving onto #5, find the current ranking after each race throughout the season.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#find the points after each race</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>marbles_12 <span class="ot">&lt;-</span> marbles_11 <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">group_by</span>(race_number) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">current_rank =</span> <span class="fu">rank</span>(<span class="fu">desc</span>(current_points),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">ties.method =</span> <span class="st">&quot;min&quot;</span>))</span></code></pre></div>
<p><br></p>
<p>Next, #6, find the differences in time between the qualifying and actual races. The qualifying races are only 1 lap each, so it’s really only meaningful to find the difference in average lap times.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>marbles_12<span class="sc">$</span>time_diff <span class="ot">&lt;-</span> marbles_12<span class="sc">$</span>race_avg_lap <span class="sc">-</span> marbles_12<span class="sc">$</span>qual_avg_lap</span></code></pre></div>
<p><br></p>
<p>Lastly, #7, calculating the speed of the marble in each race. We have variables that represent track length in m, the number of laps, and race time in seconds, so we can simply divide the two to calculate the speed in meters per second.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>marbles_12<span class="sc">$</span>speed <span class="ot">&lt;-</span> (marbles_12<span class="sc">$</span>track_length_m <span class="sc">*</span> marbles_12<span class="sc">$</span>number_laps) <span class="sc">/</span> marbles_12<span class="sc">$</span>race_time</span></code></pre></div>
<p>We can now remove any unimportant variables and rearrange the columns to make a pretty, organized dataframe.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>marbles_processed <span class="ot">&lt;-</span> marbles_12 <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                        dplyr<span class="sc">::</span><span class="fu">select</span>(race_number,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                                      site,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                                      track_length_m,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                                      number_laps,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                                      team_name,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>                                      host,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>                                      marble_name,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>                                      pole,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>                                      qual_time,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>                                      race_time,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>                                      race_avg_lap,</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>                                      speed,</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>                                      time_diff,</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>                                      points,</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>                                      current_points,</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>                                      current_rank,</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>                                      total_points,</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>                                      team_rank,</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>                                      fastest_lap_count,</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>                                      notes)</span></code></pre></div>
<hr />
</div>
<div id="save-processed-data" class="section level2">
<h2>Save Processed Data</h2>
<p>For future reference, I’m saving the processed data and the updated the data dictionary as a .Rds in the <code>data</code> folder in the GitHub repository for this website.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#location to save file</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>save_data_location <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;tidytuesday2&quot;</span>, <span class="st">&quot;processeddata.rds&quot;</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">#save processed data as .rds</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(marbles_processed, <span class="at">file =</span> save_data_location)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">#create new data dictionary</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;race_number&quot;</span>, <span class="st">&quot;site&quot;</span>, <span class="st">&quot;track_length_m&quot;</span>, <span class="st">&quot;number_laps&quot;</span>, <span class="st">&quot;team_name&quot;</span>, <span class="st">&quot;host&quot;</span>, <span class="st">&quot;marble_name&quot;</span>, <span class="st">&quot;pole&quot;</span>, <span class="st">&quot;qual_time&quot;</span>, <span class="st">&quot;race_time&quot;</span>, <span class="st">&quot;race_avg_lap&quot;</span>, <span class="st">&quot;speed&quot;</span>, <span class="st">&quot;time_diff&quot;</span>, <span class="st">&quot;points&quot;</span>, <span class="st">&quot;current points&quot;</span>, <span class="st">&quot;current_rank&quot;</span>, <span class="st">&quot;total_points&quot;</span>, <span class="st">&quot;team_rank&quot;</span>, <span class="st">&quot;fastest_lap_count&quot;</span>, <span class="st">&quot;notes&quot;</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>class <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;character&quot;</span>, <span class="st">&quot;character&quot;</span>, <span class="st">&quot;number&quot;</span>, <span class="st">&quot;number&quot;</span>, <span class="st">&quot;character&quot;</span>, <span class="st">&quot;character&quot;</span>, <span class="st">&quot;character&quot;</span>, <span class="st">&quot;character&quot;</span>, <span class="st">&quot;number&quot;</span>, <span class="st">&quot;number&quot;</span>, <span class="st">&quot;number&quot;</span>, <span class="st">&quot;number&quot;</span>, <span class="st">&quot;number&quot;</span>, <span class="st">&quot;number&quot;</span>, <span class="st">&quot;number&quot;</span>, <span class="st">&quot;integer&quot;</span>, <span class="st">&quot;number&quot;</span>, <span class="st">&quot;integer&quot;</span>, <span class="st">&quot;number&quot;</span>, <span class="st">&quot;character&quot;</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>description <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;number of the race in the season&quot;</span>, <span class="st">&quot;race location&quot;</span>, <span class="st">&quot;length of the track in meters&quot;</span>, <span class="st">&quot;number of laps for the site&quot;</span>, <span class="st">&quot;team name&quot;</span>, <span class="st">&quot;whether or not the team hosted the race&quot;</span>, <span class="st">&quot;marble name&quot;</span>, <span class="st">&quot;starting position determined by qualifying rounds&quot;</span>, <span class="st">&quot;qualifying time&quot;</span>, <span class="st">&quot;race time&quot;</span>, <span class="st">&quot;average time per lap in race&quot;</span>, <span class="st">&quot;average speed of marble in the actual race&quot;</span>, <span class="st">&quot;difference in average lap time between race and qualifying times&quot;</span>, <span class="st">&quot;points earned for the race&quot;</span>, <span class="st">&quot;cumulative points at the end of each race&quot;</span>, <span class="st">&quot;rank in the league at the end of each race&quot;</span>, <span class="st">&quot;total season points for the team&quot;</span>, <span class="st">&quot;final team ranking at the end of the season&quot;</span>, <span class="st">&quot;number of times the team had the fastest lap in the season&quot;</span>, <span class="st">&quot;notes (very few, but some notes about potential errors&quot;</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>data_dictionary_2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(variable, class, description)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data_dictionary_2)</span></code></pre></div>
<pre><code>##             variable     class
## 1        race_number character
## 2               site character
## 3     track_length_m    number
## 4        number_laps    number
## 5          team_name character
## 6               host character
## 7        marble_name character
## 8               pole character
## 9          qual_time    number
## 10         race_time    number
## 11      race_avg_lap    number
## 12             speed    number
## 13         time_diff    number
## 14            points    number
## 15    current points    number
## 16      current_rank   integer
## 17      total_points    number
## 18         team_rank   integer
## 19 fastest_lap_count    number
## 20             notes character
##                                                         description
## 1                                  number of the race in the season
## 2                                                     race location
## 3                                     length of the track in meters
## 4                                       number of laps for the site
## 5                                                         team name
## 6                           whether or not the team hosted the race
## 7                                                       marble name
## 8                 starting position determined by qualifying rounds
## 9                                                   qualifying time
## 10                                                        race time
## 11                                     average time per lap in race
## 12                       average speed of marble in the actual race
## 13 difference in average lap time between race and qualifying times
## 14                                       points earned for the race
## 15                        cumulative points at the end of each race
## 16                       rank in the league at the end of each race
## 17                                 total season points for the team
## 18                      final team ranking at the end of the season
## 19       number of times the team had the fastest lap in the season
## 20           notes (very few, but some notes about potential errors</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#location to save data dictionary</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>save_dictionary_location <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;tidytuesday2&quot;</span>, <span class="st">&quot;datadictionary.rds&quot;</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">#save data dictionary as .rds</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(data_dictionary_2, <span class="at">file =</span> save_dictionary_location)</span></code></pre></div>
<hr />
</div>
<div id="data-exploration" class="section level2">
<h2>Data Exploration</h2>
<p>Now that we’ve created a cleaned and processed dataset, let’s do some exploration. In lieu of following a formal exploratory data analysis flow, there are a few figures to create that will illustrate the data:</p>
<ol style="list-style-type: decimal">
<li>Marble names and team names</li>
<li>Competition points for each team throughout the season</li>
<li>Total competition points for each marble for each team</li>
<li>Competition points for each team at each race location</li>
<li>Team rankings throughout the season</li>
<li>Scatterplot comparing competition points against marble speed (for each race location)</li>
<li>Pairwise correlation matrix</li>
</ol>
<p><br></p>
<p>To start, create a figure that shows marble names assigned to each team.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#we can use a barplot and a facet wrap to accomplish this</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>marble_names_plot <span class="ot">&lt;-</span> marbles_processed <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                        dplyr<span class="sc">::</span><span class="fu">group_by</span>(team_name, marble_name) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                        dplyr<span class="sc">::</span><span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                        ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> marble_name, </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">y =</span> n, </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">fill =</span> team_name)) <span class="sc">+</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> marble_name),</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">vjust =</span> <span class="fl">1.75</span>, </span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">facet_wrap</span>(<span class="sc">~</span> team_name,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">nrow =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>))</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>                                 </span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>marble_names_plot</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/data%20exploration%201-1.png" width="672" /></p>
<p><br></p>
<p>Next, plot competition points for each team throughout the season.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>team_points_plot <span class="ot">&lt;-</span> marbles_processed <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                        ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> race_number,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">y =</span> current_points,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">group =</span> team_name,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">color =</span> team_name)) <span class="sc">+</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">110</span>, <span class="at">by =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">labels =</span> <span class="fu">unique</span>(marbles_processed<span class="sc">$</span>site)) <span class="sc">+</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Race&quot;</span>,</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">y =</span> <span class="st">&quot;Cumulative Points&quot;</span>) <span class="sc">+</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>,</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>                                                                  <span class="at">vjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>                                                                  <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>                                 </span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>team_points_plot</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/data%20exploration%202-1.png" width="672" /></p>
<p><br></p>
<p>Now, plot total points earned by each marble for each team at the end of the season. We don’t have the variable for points by marble created, but easy enough to include in the pre-processing before ggplot step.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>marble_points <span class="ot">&lt;-</span> marbles_processed <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">group_by</span>(team_name, marble_name) <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">marble_points =</span> <span class="fu">sum</span>(points)) <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="sc">-</span>marble_points) <span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(marble_name, marble_points),</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> marble_points,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">fill =</span> team_name)) <span class="sc">+</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">facet_wrap</span>(<span class="sc">~</span> team_name,</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Marble Name&quot;</span>,</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">y =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Total Points&quot;</span>) <span class="sc">+</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;team_name&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>marble_points</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/data%20exploration%203-1.png" width="672" /></p>
<p><br></p>
<p>To visualize points at each race location for each team, a grouped bar plot would get chaotic, and a facet_wrap would also be hard to interpret. What if we made a gradient matrix with points in each box?</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#using the points color scheme from the marble racing wiki page</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>race_teams_plot <span class="ot">&lt;-</span> marbles_processed <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                     ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> site,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">y =</span> team_name)) <span class="sc">+</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> points)) <span class="sc">+</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">&quot;#ffffbf&quot;</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>                                                               <span class="st">&quot;#dfdfdf&quot;</span>,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>                                                               <span class="st">&quot;#ffdf9f&quot;</span>,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>                                                               <span class="st">&quot;#dfffdf&quot;</span>,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>                                                               <span class="st">&quot;#cfcfff&quot;</span>),</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">values =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.7</span>, <span class="fl">0.6</span>, <span class="fl">0.3</span>, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> points)) <span class="sc">+</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Race Location&quot;</span>,</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">y =</span> <span class="st">&quot;Team Name&quot;</span>) <span class="sc">+</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>,</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>                                                               <span class="at">vjust =</span> <span class="fl">0.3</span>,</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>                                                               <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>race_teams_plot</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/data%20exploration%204-1.png" width="672" /></p>
<p><br></p>
<p>Next, plot team rankings throughout the season.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#If this was a real exercise, I would spend more time adjusting the formatting to make it prettier.</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>team_rank_plot <span class="ot">&lt;-</span> marbles_processed <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> race_number,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> current_rank,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">group =</span> team_name,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">color =</span> team_name)) <span class="sc">+</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>                             ggbump<span class="sc">::</span><span class="fu">geom_bump</span>(<span class="at">smooth =</span> <span class="dv">7</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">size =</span> <span class="fl">2.2</span>) <span class="sc">+</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">geom_point</span>(<span class="at">data =</span> marbles_processed <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(race_number <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">geom_point</span>(<span class="at">data =</span> marbles_processed <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(race_number <span class="sc">==</span> <span class="dv">8</span>),</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">stroke =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">geom_text</span>(<span class="at">data =</span> marbles_processed <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(race_number <span class="sc">==</span> <span class="dv">8</span>),</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">aes</span>(<span class="at">label =</span> team_rank),</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">hjust =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">coord_cartesian</span>(<span class="at">clip =</span> <span class="st">&quot;off&quot;</span>) <span class="sc">+</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">001</span>, .<span class="dv">001</span>),</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">labels =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">&quot;Race {1:8}&quot;</span>)) <span class="sc">+</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">03</span>, .<span class="dv">03</span>),</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">y =</span> <span class="st">&quot;Team Rank&quot;</span>) </span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>                             </span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>team_rank_plot</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/data%20exploration%205-1.png" width="672" /></p>
<p><br></p>
<p>Moving onto #6, a scatterplot of marble speed and points</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#only plot times where the marble earned a point</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>speed_points <span class="ot">&lt;-</span> marbles_processed <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">filter</span>(points <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>                  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> points, </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">y =</span> speed)) <span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_point</span>(<span class="at">col=</span><span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">facet_wrap</span>(<span class="sc">~</span> site, </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">scales =</span> <span class="st">&#39;free&#39;</span>) <span class="sc">+</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Speed (m/s)&quot;</span>,</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">x =</span> <span class="st">&quot;Points&quot;</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>speed_points</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/data%20exploration%206-1.png" width="672" /></p>
<p><br></p>
<p>Lastly, before we can think about models, let’s look at the pairwise scatter plot. We can only use the continuous variables, first subset the processed data, and then plot it.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>marbles_cont <span class="ot">&lt;-</span> marbles_processed <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">select</span>(race_number,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                              track_length_m,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                              number_laps,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>                              qual_time,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>                              race_time,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>                              race_avg_lap,</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>                              speed,</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>                              time_diff,</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>                              points,</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>                              current_points,</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>                              current_rank,</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>                              total_points,</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>                              team_rank,</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>                              fastest_lap_count)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>marbles_cont<span class="sc">$</span>race_number <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(marbles_cont<span class="sc">$</span>race_number)</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>marbles_cont<span class="sc">$</span>current_rank <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(marbles_cont<span class="sc">$</span>current_rank)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>marbles_cont<span class="sc">$</span>team_rank <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(marbles_cont<span class="sc">$</span>team_rank)</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(marbles_cont)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/data%20exploration%207-1.png" width="672" /> So not super helpful…too many variables.</p>
<hr />
</div>
<div id="research-question" class="section level2">
<h2>Research Question</h2>
<p>What are the significant predictors in predicting team score at the end of the season?</p>
<hr />
</div>
<div id="outcome-and-predictors-of-interest" class="section level2">
<h2>Outcome and Predictor(s) of Interest</h2>
<p>Outcome of interest: total team points at the end of the season (<code>total_points</code> in this code).</p>
<p>Predictors of interest include:</p>
<ul>
<li>race number</li>
<li>site</li>
<li>track length</li>
<li>number of laps</li>
<li>host</li>
<li>pole</li>
<li>qualifying time</li>
<li>race time</li>
<li>average lap time for race</li>
<li>speed of marble</li>
<li>difference in single lap time between qualifying and actual race</li>
<li>points earned at the race</li>
<li>cumulative season points</li>
<li>season rank</li>
<li>number of times in a season the team had a fastest lap</li>
</ul>
<p>I’m choosing to not include team or marble names, as it limits the applicability to other seasons/other groups.</p>
<hr />
</div>
<div id="further-cleaning-processing" class="section level2">
<h2>Further Cleaning / Processing</h2>
<p>We need to subset our processed data and adjust the variable formats before creating the machine learning models.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#drop the season-specific variables</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>marbles_ML <span class="ot">&lt;-</span> marbles_processed <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(team_name,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                                 marble_name,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>                                 team_rank,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                                 notes))</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co">#adjust variable formats</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>marbles_ML<span class="sc">$</span>race_number <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(marbles_ML<span class="sc">$</span>race_number)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>marbles_ML<span class="sc">$</span>current_rank <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(marbles_ML<span class="sc">$</span>current_rank)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="co">#remove the &quot;P&quot; from the pole variable.</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>marbles_ML<span class="sc">$</span>pole <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(stringr<span class="sc">::</span><span class="fu">str_sub</span>(marbles_ML<span class="sc">$</span>pole, <span class="dv">2</span>))</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="co">#LASSO won&#39;t handle NA values, so replace NAs with 0 for the marbles that did not finish races</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>marbles_ML[<span class="fu">is.na</span>(marbles_ML)] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code></pre></div>
<hr />
</div>
<div id="setting-up-the-data-for-machine-learning" class="section level2">
<h2>Setting up the Data for Machine Learning</h2>
<p>Specify the following parameters:</p>
<ul>
<li>Set the random seed to <code>123</code></li>
<li>Split the dataset into 70% training, 30% testing, using <code>total_points</code> as the stratification variable</li>
<li>5-fold cross validation, 5 times repeated, stratified on <code>total_points</code> for the CV folds</li>
<li>Create a recipe for the data and fitting that codes the two categorical variables as dummy variables</li>
</ul>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#set random seed to 123</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co">#split dataset into 70% training, 30% testing</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co">#use BodyTemp as stratification</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>data_split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(marbles_ML, <span class="at">prop =</span> <span class="dv">7</span><span class="sc">/</span><span class="dv">10</span>,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">strata =</span> total_points)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="co">#create dataframes for the two sets:</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(data_split)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(data_split)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co">#5-fold cross validation, 5 times repeated, stratified on `total_points` for the CV folds</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">vfold_cv</span>(train_data,</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>                           <span class="at">v =</span> <span class="dv">5</span>,</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>                           <span class="at">repeats =</span> <span class="dv">5</span>,</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>                           <span class="at">strata =</span> total_points)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="co">#create recipe that codes categorical variables as dummy variables</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>marbles_rec <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(total_points <span class="sc">~</span> ., <span class="at">data =</span> train_data) <span class="sc">%&gt;%</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>               recipes<span class="sc">::</span><span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>())</span></code></pre></div>
<hr />
</div>
<div id="null-model-performance" class="section level2">
<h2>Null Model Performance</h2>
<p>Determine the performance of a null model (i.e. one with no predictors). For a continuous outcome and RMSE as the metric, a null model is one that predicts the mean of the outcome. Compute the RMSE for both training and test data for such a model.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create null model</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>null_mod <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">null_model</span>() <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>            parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">&quot;parsnip&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>            parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co">#add recipe and model into workflow</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>null_wflow <span class="ot">&lt;-</span> workflows<span class="sc">::</span><span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>              workflows<span class="sc">::</span><span class="fu">add_recipe</span>(marbles_rec) <span class="sc">%&gt;%</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>              workflows<span class="sc">::</span><span class="fu">add_model</span>(null_mod)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&quot;fit&quot; model to training data</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>null_train <span class="ot">&lt;-</span> null_wflow <span class="sc">%&gt;%</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>                parsnip<span class="sc">::</span><span class="fu">fit</span>(<span class="at">data =</span> train_data)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co">#summary of null model with training data to get mean (which in this case is the RMSE)</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>null_train_sum <span class="ot">&lt;-</span> broom.mixed<span class="sc">::</span><span class="fu">tidy</span>(null_train)</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>null_train_sum</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   value
##   &lt;dbl&gt;
## 1  51.5</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#RMSE for training data</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>null_RMSE_train <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rmse =</span> <span class="fu">rmse_vec</span>(<span class="at">truth =</span> train_data<span class="sc">$</span>total_points,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">estimate =</span> <span class="fu">rep</span>(<span class="fu">mean</span>(train_data<span class="sc">$</span>total_points), <span class="fu">nrow</span>(train_data))),</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">SE =</span> <span class="dv">0</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">model =</span> <span class="st">&quot;Null - Train&quot;</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co">#RMSE for testing data</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>null_RMSE_test <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rmse =</span> <span class="fu">rmse_vec</span>(<span class="at">truth =</span> test_data<span class="sc">$</span>total_points,</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">estimate =</span> <span class="fu">rep</span>(<span class="fu">mean</span>(test_data<span class="sc">$</span>total_points), <span class="fu">nrow</span>(test_data))),</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">SE =</span> <span class="dv">0</span>,</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">model =</span> <span class="st">&quot;Null - Test&quot;</span>)</span></code></pre></div>
<hr />
</div>
<div id="ml-model-1-decision-tree-model" class="section level2">
<h2>ML Model #1: Decision Tree Model</h2>
<p>Most of the code for this section comes from the <a href="https://www.tidymodels.org/start/tuning/">TidyModels Tutorial for Tuning</a>.</p>
<div id="model-specification" class="section level3">
<h3>1. Model Specification</h3>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#run parallels to determine number of cores</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>cores</span></code></pre></div>
<pre><code>## [1] 19</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(cores)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co">#define the tree model</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>tree_mod <span class="ot">&lt;-</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">decision_tree</span>(<span class="at">cost_complexity =</span> <span class="fu">tune</span>(),</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">min_n =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">&quot;rpart&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="co">#use the recipe specified earlier</span></span></code></pre></div>
<p><br></p>
</div>
<div id="workflow-definition" class="section level3">
<h3>2. Workflow Definition</h3>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#define workflow for tree</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>tree_wflow <span class="ot">&lt;-</span> workflows<span class="sc">::</span><span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>               workflows<span class="sc">::</span><span class="fu">add_model</span>(tree_mod) <span class="sc">%&gt;%</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>               workflows<span class="sc">::</span><span class="fu">add_recipe</span>(marbles_rec)</span></code></pre></div>
<p><br></p>
</div>
<div id="tuning-grid-specification" class="section level3">
<h3>3. Tuning Grid Specification</h3>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#tuning grid specification</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>tree_grid <span class="ot">&lt;-</span> dials<span class="sc">::</span><span class="fu">grid_regular</span>(<span class="fu">cost_complexity</span>(),</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">tree_depth</span>(),</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">min_n</span>(),</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">levels =</span> <span class="dv">5</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co">#tree depth</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>tree_grid <span class="sc">%&gt;%</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(tree_depth)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   tree_depth     n
##        &lt;int&gt; &lt;int&gt;
## 1          1    25
## 2          4    25
## 3          8    25
## 4         11    25
## 5         15    25</code></pre>
<p><br></p>
</div>
<div id="tuning-using-cross-validation-and-the-tune_grid-function" class="section level3">
<h3>4. Tuning Using Cross-Validation and the <code>tune_grid()</code> function</h3>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">#tune the model with previously specified cross-validation and RMSE as target metric</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>tree_res <span class="ot">&lt;-</span> tree_wflow <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>                tune<span class="sc">::</span><span class="fu">tune_grid</span>(<span class="at">resamples =</span> folds,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">grid =</span> tree_grid,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">verbose =</span> <span class="cn">TRUE</span>),</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>                                <span class="at">metrics =</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(rmse))</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co">#collect metrics</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>tree_res <span class="sc">%&gt;%</span> workflowsets<span class="sc">::</span><span class="fu">collect_metrics</span>()</span></code></pre></div>
<pre><code>## # A tibble: 125 x 9
##    cost_complexity tree_depth min_n .metric .estimator  mean     n std_err
##              &lt;dbl&gt;      &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1    0.0000000001          1     2 rmse    standard    17.1    25   0.412
##  2    0.0000000178          1     2 rmse    standard    17.1    25   0.412
##  3    0.00000316            1     2 rmse    standard    17.1    25   0.412
##  4    0.000562              1     2 rmse    standard    17.1    25   0.412
##  5    0.1                   1     2 rmse    standard    17.1    25   0.412
##  6    0.0000000001          4     2 rmse    standard    16.4    25   0.608
##  7    0.0000000178          4     2 rmse    standard    16.4    25   0.608
##  8    0.00000316            4     2 rmse    standard    16.4    25   0.608
##  9    0.000562              4     2 rmse    standard    16.4    25   0.609
## 10    0.1                   4     2 rmse    standard    16.0    25   0.404
## # ... with 115 more rows, and 1 more variable: .config &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#default visualization</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>tree_res <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">#more detailed plot</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>tree_res <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  workflowsets<span class="sc">::</span><span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">tree_depth =</span> <span class="fu">factor</span>(tree_depth)) <span class="sc">%&gt;%</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(cost_complexity, mean, <span class="at">color =</span> tree_depth)) <span class="sc">+</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">facet_wrap</span>(<span class="sc">~</span> .metric, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">nrow =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>()) <span class="sc">+</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>           <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="at">begin =</span> <span class="fl">0.9</span>, <span class="at">end =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
<p><br></p>
</div>
<div id="identify-best-model" class="section level3">
<h3>5. Identify Best Model</h3>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#select the tree model with the lowest rmse</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>tree_lowest_rmse <span class="ot">&lt;-</span> tree_res <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>                        tune<span class="sc">::</span><span class="fu">select_best</span>(<span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co">#finalize the workflow by using the selected lasso model</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>best_tree_wflow <span class="ot">&lt;-</span> tree_wflow <span class="sc">%&gt;%</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>                      tune<span class="sc">::</span><span class="fu">finalize_workflow</span>(tree_lowest_rmse)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>best_tree_wflow</span></code></pre></div>
<pre><code>## == Workflow ====================================================================
## Preprocessor: Recipe
## Model: decision_tree()
## 
## -- Preprocessor ----------------------------------------------------------------
## 1 Recipe Step
## 
## * step_dummy()
## 
## -- Model -----------------------------------------------------------------------
## Decision Tree Model Specification (regression)
## 
## Main Arguments:
##   cost_complexity = 0.0000000001
##   tree_depth = 4
##   min_n = 11
## 
## Computational engine: rpart</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#one last fit on the training data</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>best_tree_fit <span class="ot">&lt;-</span> best_tree_wflow <span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                    parsnip<span class="sc">::</span><span class="fu">fit</span>(<span class="at">data =</span> train_data)</span></code></pre></div>
<p><br></p>
</div>
<div id="model-evaluation" class="section level3">
<h3>6. Model evaluation</h3>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot the tree</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>rpart.plot<span class="sc">::</span><span class="fu">rpart.plot</span>(<span class="at">x =</span> workflowsets<span class="sc">::</span><span class="fu">extract_fit_parsnip</span>(best_tree_fit)<span class="sc">$</span>fit,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">roundint =</span> F,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type =</span> <span class="dv">5</span>,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">digits =</span> <span class="dv">5</span>,</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">main =</span> <span class="st">&quot;Selected Tree Model&quot;</span>)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co">#find predictions and intervals</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>tree_resid <span class="ot">&lt;-</span> best_tree_fit <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                  broom.mixed<span class="sc">::</span><span class="fu">augment</span>(<span class="at">new_data =</span> train_data) <span class="sc">%&gt;%</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">select</span>(.pred, total_points) <span class="sc">%&gt;%</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">.resid =</span> .pred <span class="sc">-</span> total_points)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="co">#plot model predictions from tuned model versus actual outcomes</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="co">#geom_abline draws a 45 degree line, along which the results should fall</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(tree_resid, <span class="fu">aes</span>(<span class="at">x =</span> .pred, <span class="at">y =</span> total_points)) <span class="sc">+</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Decision Tree Fit: Predicted vs. Actual Total Points&quot;</span>,</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;Predicted Total Points&quot;</span>,</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Actual Total Points&quot;</span>)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-6-2.png" width="672" /></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot model with residuals</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="co">#the geom_hline plots a straight horizontal line along which the results should fall</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(tree_resid, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(<span class="fu">row.names</span>(tree_resid)), <span class="at">y =</span> .resid))<span class="sc">+</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Decision Tree Fit: Residuals&quot;</span>,</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;Observation Number&quot;</span>,</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Residual&quot;</span>)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-6-3.png" width="672" /></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot model fit vs residuals</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co">#the geom_hline plots a straight horizontal line along which the results fall</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(tree_resid, <span class="fu">aes</span>(<span class="at">x =</span> .pred, <span class="at">y =</span> .resid))<span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Decision Tree Fit: Residuals vs Fitted Total Points&quot;</span>,</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;Fitted Total Points&quot;</span>,</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Residual&quot;</span>)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-6-4.png" width="672" /></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">#print model performance</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co">#print 10 best performing hyperparameter sets</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>tree_res <span class="sc">%&gt;%</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">show_best</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">rmse =</span> mean, std_err, cost_complexity) <span class="sc">%&gt;%</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">rmse =</span> <span class="fu">round</span>(rmse, <span class="dv">3</span>),</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">std_err =</span> <span class="fu">round</span>(std_err, <span class="dv">4</span>),</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">cost_complexity =</span> scales<span class="sc">::</span><span class="fu">scientific</span>(cost_complexity))</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##     rmse std_err cost_complexity
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;          
##  1  14.5   0.422 1.00e-10       
##  2  14.5   0.422 1.78e-08       
##  3  14.5   0.422 3.16e-06       
##  4  14.5   0.422 5.62e-04       
##  5  14.9   0.437 1.00e-10       
##  6  14.9   0.437 1.78e-08       
##  7  14.9   0.437 3.16e-06       
##  8  14.9   0.437 5.62e-04       
##  9  14.9   0.427 1.00e-10       
## 10  14.9   0.427 1.78e-08</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#print the best model performance</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>tree_performance <span class="ot">&lt;-</span> tree_res <span class="sc">%&gt;%</span> tune<span class="sc">::</span><span class="fu">show_best</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tree_performance)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 9
##   cost_complexity tree_depth min_n .metric .estimator  mean     n std_err
##             &lt;dbl&gt;      &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1    0.0000000001          4    11 rmse    standard    14.5    25   0.422
## # ... with 1 more variable: .config &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#compare model performance to null model</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>tree_RMSE <span class="ot">&lt;-</span> tree_res <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>                tune<span class="sc">::</span><span class="fu">show_best</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">transmute</span>(</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">rmse =</span> <span class="fu">round</span>(mean, <span class="dv">3</span>),</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">SE =</span> <span class="fu">round</span>(std_err, <span class="dv">4</span>),</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">model =</span> <span class="st">&quot;Tree&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>               dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(null_RMSE_train)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>tree_RMSE</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##    rmse    SE model       
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       
## 1  14.5 0.422 Tree        
## 2  23.5 0     Null - Train</code></pre>
<p>The identified best performing tree model includes current_rank, fastest_lap_count, current_points, and race_time as key predictor variables. In comparing the RMSE to the null model, this is about a 33% reduction in RMSE, so it’s promising. Let’s try some other models.</p>
<p><br></p>
<hr />
<p><br></p>
</div>
</div>
<div id="lasso-model" class="section level2">
<h2>LASSO Model</h2>
<p>Most of the code for this section comes from the <a href="https://www.tidymodels.org/start/case-study/">TidyModels Tutorial Case Study</a>.</p>
<p><br></p>
<div id="model-specification-1" class="section level3">
<h3>1. Model Specification</h3>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#define the lasso model</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co">#mixture = 1 identifies the model to be a LASSO model</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>lasso_mod <span class="ot">&lt;-</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">linear_reg</span>(<span class="at">mode =</span> <span class="st">&quot;regression&quot;</span>,</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">penalty =</span> <span class="fu">tune</span>(), </span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">mixture =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="co">#use the recipe specified earlier</span></span></code></pre></div>
<p><br></p>
</div>
<div id="workflow-definition-1" class="section level3">
<h3>2. Workflow Definition</h3>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">#define workflow for lasso regression</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>lasso_wflow <span class="ot">&lt;-</span> workflows<span class="sc">::</span><span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>               workflows<span class="sc">::</span><span class="fu">add_model</span>(lasso_mod) <span class="sc">%&gt;%</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>               workflows<span class="sc">::</span><span class="fu">add_recipe</span>(marbles_rec)</span></code></pre></div>
<p><br></p>
</div>
<div id="tuning-grid-specification-1" class="section level3">
<h3>3. Tuning Grid Specification</h3>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">#tuning grid specification</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>lasso_grid <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">penalty =</span> <span class="dv">10</span><span class="sc">^</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="at">length.out =</span> <span class="dv">30</span>))</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co">#5 lowest penalty values</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>lasso_grid <span class="sc">%&gt;%</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">top_n</span>(<span class="sc">-</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>## Selecting by penalty</code></pre>
<pre><code>## # A tibble: 5 x 1
##   penalty
##     &lt;dbl&gt;
## 1 0.001  
## 2 0.00161
## 3 0.00259
## 4 0.00418
## 5 0.00672</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">#5 highest penalty values</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>lasso_grid <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">top_n</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## Selecting by penalty</code></pre>
<pre><code>## # A tibble: 5 x 1
##   penalty
##     &lt;dbl&gt;
## 1    149.
## 2    240.
## 3    386.
## 4    621.
## 5   1000</code></pre>
<p><br></p>
</div>
<div id="tuning-using-cross-validation-and-the-tune_grid-function-1" class="section level3">
<h3>4. Tuning Using Cross-Validation and the <code>tune_grid()</code> function</h3>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co">#tune the model with previously specified cross-validation and RMSE as target metric</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>lasso_res <span class="ot">&lt;-</span> lasso_wflow <span class="sc">%&gt;%</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>                tune<span class="sc">::</span><span class="fu">tune_grid</span>(<span class="at">resamples =</span> folds,</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">grid =</span> lasso_grid,</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">verbose =</span> <span class="cn">TRUE</span>, </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">save_pred =</span> <span class="cn">TRUE</span>),</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>                                <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse))</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="co">#look at 15 models with lowest RMSEs</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>top_lasso_models <span class="ot">&lt;-</span> lasso_res <span class="sc">%&gt;%</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>                      tune<span class="sc">::</span><span class="fu">show_best</span>(<span class="st">&quot;rmse&quot;</span>, <span class="at">n =</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>                      dplyr<span class="sc">::</span><span class="fu">arrange</span>(penalty)</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>top_lasso_models</span></code></pre></div>
<pre><code>## # A tibble: 15 x 7
##    penalty .metric .estimator  mean     n std_err .config              
##      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
##  1 0.00418 rmse    standard    13.3    25   0.436 Preprocessor1_Model04
##  2 0.00672 rmse    standard    13.3    25   0.434 Preprocessor1_Model05
##  3 0.0108  rmse    standard    13.3    25   0.433 Preprocessor1_Model06
##  4 0.0174  rmse    standard    13.3    25   0.430 Preprocessor1_Model07
##  5 0.0281  rmse    standard    13.3    25   0.427 Preprocessor1_Model08
##  6 0.0452  rmse    standard    13.2    25   0.424 Preprocessor1_Model09
##  7 0.0728  rmse    standard    13.2    25   0.420 Preprocessor1_Model10
##  8 0.117   rmse    standard    13.1    25   0.418 Preprocessor1_Model11
##  9 0.189   rmse    standard    13.1    25   0.418 Preprocessor1_Model12
## 10 0.304   rmse    standard    13.0    25   0.418 Preprocessor1_Model13
## 11 0.489   rmse    standard    13.0    25   0.416 Preprocessor1_Model14
## 12 0.788   rmse    standard    13.0    25   0.406 Preprocessor1_Model15
## 13 1.27    rmse    standard    13.0    25   0.387 Preprocessor1_Model16
## 14 2.04    rmse    standard    13.0    25   0.373 Preprocessor1_Model17
## 15 3.29    rmse    standard    13.2    25   0.375 Preprocessor1_Model18</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co">#default visualization</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>lasso_res <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create a graph to see when there is a significant change in the penalty</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co">#this is the same as above, just a little more detail</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>lasso_res <span class="sc">%&gt;%</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  workflowsets<span class="sc">::</span><span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(penalty, mean, <span class="at">color =</span> .metric)) <span class="sc">+</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean <span class="sc">-</span> std_err,</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ymax =</span> mean <span class="sc">+</span> std_err),</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_log10</span>()</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-10-2.png" width="672" /></p>
<p><br></p>
</div>
<div id="identify-best-model-1" class="section level3">
<h3>5. Identify Best Model</h3>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co">#select the lasso model with the lowest rmse</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>lasso_lowest_rmse <span class="ot">&lt;-</span> lasso_res <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>                        tune<span class="sc">::</span><span class="fu">select_best</span>(<span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="co">#finalize the workflow by using the selected lasso model</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>best_lasso_wflow <span class="ot">&lt;-</span> lasso_wflow <span class="sc">%&gt;%</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>                      tune<span class="sc">::</span><span class="fu">finalize_workflow</span>(lasso_lowest_rmse)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>best_lasso_wflow</span></code></pre></div>
<pre><code>## == Workflow ====================================================================
## Preprocessor: Recipe
## Model: linear_reg()
## 
## -- Preprocessor ----------------------------------------------------------------
## 1 Recipe Step
## 
## * step_dummy()
## 
## -- Model -----------------------------------------------------------------------
## Linear Regression Model Specification (regression)
## 
## Main Arguments:
##   penalty = 2.04335971785694
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">#one last fit on the training data</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>best_lasso_fit <span class="ot">&lt;-</span> best_lasso_wflow <span class="sc">%&gt;%</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>                    parsnip<span class="sc">::</span><span class="fu">fit</span>(<span class="at">data =</span> train_data)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="co">#create a table of model fit that includes the predictors in the model</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co">#i.e. include all non-zero estimates</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>lasso_tibble <span class="ot">&lt;-</span> best_lasso_fit <span class="sc">%&gt;%</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>                    workflowsets<span class="sc">::</span><span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>                    broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">filter</span>(estimate <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">mutate_if</span>(is.numeric, round, <span class="dv">4</span>)</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>lasso_tibble</span></code></pre></div>
<pre><code>## # A tibble: 5 x 3
##   term              estimate penalty
##   &lt;chr&gt;                &lt;dbl&gt;   &lt;dbl&gt;
## 1 (Intercept)         66.9      2.04
## 2 current_points       0.112    2.04
## 3 current_rank        -2.68     2.04
## 4 fastest_lap_count   10.2      2.04
## 5 host_Yes             1.89     2.04</code></pre>
<p><br></p>
</div>
<div id="model-evaluation-1" class="section level3">
<h3>6. Model evaluation</h3>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">#extract model from final fit</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>x_lasso <span class="ot">&lt;-</span> best_lasso_fit<span class="sc">$</span>fit<span class="sc">$</span>fit<span class="sc">$</span>fit</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="co">#plot how number of predictors included in LASSO model changes with the tuning parameter</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x_lasso, <span class="st">&quot;lambda&quot;</span>)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">#the larger the regularization penalty, the fewer the predictors in the model</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="co">#find predictions and intervals</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>lasso_resid <span class="ot">&lt;-</span> best_lasso_fit <span class="sc">%&gt;%</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>                  broom.mixed<span class="sc">::</span><span class="fu">augment</span>(<span class="at">new_data =</span> train_data) <span class="sc">%&gt;%</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">select</span>(.pred, total_points) <span class="sc">%&gt;%</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">.resid =</span> .pred <span class="sc">-</span> total_points)</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="co">#plot model predictions from tuned model versus actual outcomes</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a><span class="co">#geom_abline plots a 45 degree line along which the results should fall</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(lasso_resid, <span class="fu">aes</span>(<span class="at">x =</span> .pred, <span class="at">y =</span> total_points)) <span class="sc">+</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;LASSO fit: Predicted vs. Actual Total Points&quot;</span>,</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;Actual Total Points&quot;</span>,</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Predicted Total Points&quot;</span>)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-12-2.png" width="672" /></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot model with residuals</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="co">#the geom_hline plots a straight horizontal line along which the results should fall</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(lasso_resid, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(<span class="fu">row.names</span>(lasso_resid)), <span class="at">y =</span> .resid))<span class="sc">+</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;LASSO Fit: Residuals&quot;</span>,</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;Observation Number&quot;</span>,</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Residual&quot;</span>)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-12-3.png" width="672" /></p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot model fit vs residuals</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="co">#the geom_hline plots a straight horizontal line along which the results fall</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(lasso_resid, <span class="fu">aes</span>(<span class="at">x =</span> .pred, <span class="at">y =</span> .resid))<span class="sc">+</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;LASSO Fit: Residuals vs Fitted Total Points&quot;</span>,</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;Fitted Total Points&quot;</span>,</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Residual&quot;</span>)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-12-4.png" width="672" /></p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co">#print the 10 best performing hyperparameter sets</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>lasso_res <span class="sc">%&gt;%</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">show_best</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">rmse =</span> mean, std_err, penalty) <span class="sc">%&gt;%</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">rmse =</span> <span class="fu">round</span>(rmse, <span class="dv">3</span>),</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">std_err =</span> <span class="fu">round</span>(std_err, <span class="dv">4</span>),</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">log penalty</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">log</span>(penalty), <span class="dv">3</span>),</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">.keep =</span> <span class="st">&quot;unused&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##     rmse std_err `log penalty`
##    &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;
##  1  13.0   0.373         0.715
##  2  13.0   0.416        -0.715
##  3  13.0   0.418        -1.19 
##  4  13.0   0.406        -0.238
##  5  13.0   0.387         0.238
##  6  13.1   0.418        -1.67 
##  7  13.1   0.418        -2.14 
##  8  13.2   0.420        -2.62 
##  9  13.2   0.376         1.19 
## 10  13.2   0.424        -3.10</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">#print best model performance</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>lasso_performance <span class="ot">&lt;-</span> lasso_res <span class="sc">%&gt;%</span> tune<span class="sc">::</span><span class="fu">show_best</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>lasso_performance</span></code></pre></div>
<pre><code>## # A tibble: 1 x 7
##   penalty .metric .estimator  mean     n std_err .config              
##     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
## 1    2.04 rmse    standard    13.0    25   0.373 Preprocessor1_Model17</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co">#compare model performance to null model and tree model</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>lasso_RMSE <span class="ot">&lt;-</span> lasso_res <span class="sc">%&gt;%</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>                tune<span class="sc">::</span><span class="fu">show_best</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">transmute</span>(</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">rmse =</span> <span class="fu">round</span>(mean, <span class="dv">3</span>),</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">SE =</span> <span class="fu">round</span>(std_err, <span class="dv">4</span>),</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">model =</span> <span class="st">&quot;LASSO&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>               dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(tree_RMSE)</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>lasso_RMSE</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##    rmse    SE model       
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       
## 1  13.0 0.373 LASSO       
## 2  14.5 0.422 Tree        
## 3  23.5 0     Null - Train</code></pre>
<p>In examining the results of the model, there is an improvement of the target metric (RMSE) under the LASSO model in comparison to the Decision Tree and Null models. However, the residual plots and observed vs fitted plots suggest the fit still isn’t ideal. Time to try another model!</p>
<p><br></p>
<hr />
<p><br></p>
</div>
</div>
<div id="random-forest-model" class="section level2">
<h2>Random Forest Model</h2>
<p>Most of the code for this section comes from the <a href="https://www.tidymodels.org/start/case-study/">TidyModels Tutorial Case Study</a>.</p>
<p><br></p>
<div id="model-specification-2" class="section level3">
<h3>1. Model Specification</h3>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co">#run parallels to determine number of cores</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>cores</span></code></pre></div>
<pre><code>## [1] 19</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(cores)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="co">#define the RF model</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>RF_mod <span class="ot">&lt;-</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">rand_forest</span>(<span class="at">mtry =</span> <span class="fu">tune</span>(),</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">min_n =</span> <span class="fu">tune</span>(),</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">trees =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">importance =</span> <span class="st">&quot;permutation&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a><span class="co">#use the recipe specified earlier (line 133)</span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a><span class="co">#check to make sure identified parameters will be tuned</span></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>RF_mod <span class="sc">%&gt;%</span> tune<span class="sc">::</span><span class="fu">parameters</span>()</span></code></pre></div>
<pre><code>## Collection of 3 parameters for tuning
## 
##  identifier  type    object
##        mtry  mtry nparam[?]
##       trees trees nparam[+]
##       min_n min_n nparam[+]
## 
## Model parameters needing finalization:
##    # Randomly Selected Predictors (&#39;mtry&#39;)
## 
## See `?dials::finalize` or `?dials::update.parameters` for more information.</code></pre>
<p><br></p>
</div>
<div id="workflow-definition-2" class="section level3">
<h3>2. Workflow Definition</h3>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co">#define workflow for RF regression</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>RF_wflow <span class="ot">&lt;-</span> workflows<span class="sc">::</span><span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>               workflows<span class="sc">::</span><span class="fu">add_model</span>(RF_mod) <span class="sc">%&gt;%</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>               workflows<span class="sc">::</span><span class="fu">add_recipe</span>(marbles_rec)</span></code></pre></div>
<p><br></p>
</div>
<div id="tuning-grid-specification-2" class="section level3">
<h3>3. Tuning Grid Specification</h3>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co">#tuning grid specification</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>RF_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">mtry =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">min_n =</span> <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>),</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">trees =</span> <span class="fu">c</span>(<span class="dv">500</span>,<span class="dv">1000</span>))</span></code></pre></div>
<p><br></p>
</div>
<div id="tuning-using-cross-validation-and-the-tune_grid-function-2" class="section level3">
<h3>4. Tuning Using Cross-Validation and the <code>tune_grid()</code> function</h3>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co">#tune the model with previously specified cross-validation and RMSE as target metric</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>RF_res <span class="ot">&lt;-</span> RF_wflow <span class="sc">%&gt;%</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>              tune<span class="sc">::</span><span class="fu">tune_grid</span>(<span class="at">resamples =</span> folds,</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">grid =</span> RF_grid,</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">verbose =</span> <span class="cn">TRUE</span>, <span class="at">save_pred =</span> <span class="cn">TRUE</span>),</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse))</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a><span class="co">#look at top 5 RF models</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>top_RF_models <span class="ot">&lt;-</span> RF_res <span class="sc">%&gt;%</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>                    tune<span class="sc">::</span><span class="fu">show_best</span>(<span class="st">&quot;rmse&quot;</span>, <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>top_RF_models</span></code></pre></div>
<pre><code>## # A tibble: 5 x 9
##    mtry trees min_n .metric .estimator  mean     n std_err .config              
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
## 1     6  1000    40 rmse    standard    14.5    25   0.410 Preprocessor1_Model16
## 2     6   500    40 rmse    standard    14.5    25   0.412 Preprocessor1_Model04
## 3     6  1000    50 rmse    standard    15.0    25   0.421 Preprocessor1_Model20
## 4     5  1000    40 rmse    standard    15.0    25   0.419 Preprocessor1_Model15
## 5     6   500    50 rmse    standard    15.0    25   0.409 Preprocessor1_Model08</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co">#default visualization</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>RF_res <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co">#in future analyses, might be worth more tuning with a higher minimum node size</span></span></code></pre></div>
<p><br></p>
</div>
<div id="identify-best-model-2" class="section level3">
<h3>5. Identify Best Model</h3>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co">#select the RF model with the lowest rmse</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>RF_lowest_rmse <span class="ot">&lt;-</span> RF_res <span class="sc">%&gt;%</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>                      tune<span class="sc">::</span><span class="fu">select_best</span>(<span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="co">#finalize the workflow by using the selected RF model</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>best_RF_wflow <span class="ot">&lt;-</span> RF_wflow <span class="sc">%&gt;%</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>                      tune<span class="sc">::</span><span class="fu">finalize_workflow</span>(RF_lowest_rmse)</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>best_RF_wflow</span></code></pre></div>
<pre><code>## == Workflow ====================================================================
## Preprocessor: Recipe
## Model: rand_forest()
## 
## -- Preprocessor ----------------------------------------------------------------
## 1 Recipe Step
## 
## * step_dummy()
## 
## -- Model -----------------------------------------------------------------------
## Random Forest Model Specification (regression)
## 
## Main Arguments:
##   mtry = 6
##   trees = 1000
##   min_n = 40
## 
## Engine-Specific Arguments:
##   importance = permutation
## 
## Computational engine: ranger</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co">#one last fit on the training data</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>best_RF_fit <span class="ot">&lt;-</span> best_RF_wflow <span class="sc">%&gt;%</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>                    parsnip<span class="sc">::</span><span class="fu">fit</span>(<span class="at">data =</span> train_data)</span></code></pre></div>
<p><br></p>
</div>
<div id="model-evaluation-2" class="section level3">
<h3>6. Model evaluation</h3>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co">#extract model from final fit</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>x_RF <span class="ot">&lt;-</span> best_RF_fit<span class="sc">$</span>fit<span class="sc">$</span>fit<span class="sc">$</span>fit</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co">#plot most important predictors in the model</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>vip<span class="sc">::</span><span class="fu">vip</span>(x_RF, <span class="at">num_features =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co">#find predictions and intervals</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>RF_resid <span class="ot">&lt;-</span> best_RF_fit <span class="sc">%&gt;%</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>                broom.mixed<span class="sc">::</span><span class="fu">augment</span>(<span class="at">new_data =</span> train_data) <span class="sc">%&gt;%</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">select</span>(.pred, total_points) <span class="sc">%&gt;%</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">.resid =</span> .pred <span class="sc">-</span> total_points)</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a><span class="co">#plot model predictions from tuned model versus actual outcomes</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a><span class="co">#geom_abline is a 45 degree line, along which the results should fall</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(RF_resid, <span class="fu">aes</span>(<span class="at">x =</span> .pred, <span class="at">y =</span> total_points)) <span class="sc">+</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;RF Fit: Actual vs. Predicted Total Points&quot;</span>,</span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;Predicted Total Points&quot;</span>,</span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Actual Total Points&quot;</span>)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-18-2.png" width="672" /></p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot model with residuals</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="co">#the geom_hline plots a straight horizontal line along which the results should fall</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(RF_resid, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(<span class="fu">row.names</span>(RF_resid)), <span class="at">y =</span> .resid))<span class="sc">+</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;RF Fit: Residuals&quot;</span>,</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;Observation Number&quot;</span>,</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Residual&quot;</span>)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-18-3.png" width="672" /></p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot model fit vs residuals</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="co">#the geom_hline plots a straight horizontal line along which the results fall</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(RF_resid, <span class="fu">aes</span>(<span class="at">x =</span> .pred, <span class="at">y =</span> .resid))<span class="sc">+</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;LASSO Fit: Residuals vs Fitted Total Points&quot;</span>,</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;Fitted Total Points&quot;</span>,</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Residual&quot;</span>)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-18-4.png" width="672" /></p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co">#print the 10 best performing hyperparameter sets</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>RF_res <span class="sc">%&gt;%</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">show_best</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">rmse =</span> mean, std_err) <span class="sc">%&gt;%</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">rmse =</span> <span class="fu">round</span>(rmse, <span class="dv">3</span>),</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">std_err =</span> <span class="fu">round</span>(std_err, <span class="dv">4</span>),</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">.keep =</span> <span class="st">&quot;unused&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 2
##     rmse std_err
##    &lt;dbl&gt;   &lt;dbl&gt;
##  1  14.5   0.41 
##  2  14.5   0.412
##  3  15.0   0.422
##  4  15.0   0.419
##  5  15.0   0.409
##  6  15.1   0.423
##  7  15.6   0.420
##  8  15.7   0.441
##  9  15.8   0.436
## 10  15.9   0.437</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co">#print the best model</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>RF_performance <span class="ot">&lt;-</span> RF_res <span class="sc">%&gt;%</span> tune<span class="sc">::</span><span class="fu">show_best</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>RF_performance</span></code></pre></div>
<pre><code>## # A tibble: 1 x 9
##    mtry trees min_n .metric .estimator  mean     n std_err .config              
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
## 1     6  1000    40 rmse    standard    14.5    25   0.410 Preprocessor1_Model16</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co">#compare model performance to null model (and other models)</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>RF_RMSE <span class="ot">&lt;-</span> RF_res <span class="sc">%&gt;%</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>              tune<span class="sc">::</span><span class="fu">show_best</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">transmute</span>(</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">rmse =</span> <span class="fu">round</span>(mean, <span class="dv">3</span>),</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">SE =</span> <span class="fu">round</span>(std_err, <span class="dv">4</span>),</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">model =</span> <span class="st">&quot;RF&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>             dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(lasso_RMSE)</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>RF_RMSE</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##    rmse    SE model       
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       
## 1  14.5 0.41  RF          
## 2  13.0 0.373 LASSO       
## 3  14.5 0.422 Tree        
## 4  23.5 0     Null - Train</code></pre>
<p>In examining the results of the RF model within the context of RMSE, it does not perform better than the LASSO, but it has an approximately comparable performance to the decision tree model. By far, the most important variables are fastest_lap_count, current_rank, current_points, and points obtained during the race.</p>
<hr />
</div>
</div>
<div id="bagged-decision-tree-model" class="section level2">
<h2>Bagged Decision Tree Model</h2>
<p><br></p>
<div id="model-specification-3" class="section level3">
<h3>1. Model Specification</h3>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co">#run parallels to determine number of cores</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>cores</span></code></pre></div>
<pre><code>## [1] 19</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(cores)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="co">#start over with random seed for bootstrapping</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="co">#set random seed</span></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20140102</span>)</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a><span class="co">#use bootstrap instead of CV</span></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>data_bootstrap <span class="ot">&lt;-</span> train_data <span class="sc">%&gt;%</span></span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>                    rsample<span class="sc">::</span><span class="fu">bootstraps</span>(<span class="at">times =</span> <span class="dv">10</span>,</span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">strata =</span> total_points)</span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a><span class="co">#define model</span></span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>bag_tree_mod <span class="ot">&lt;-</span> baguette<span class="sc">::</span><span class="fu">bag_tree</span>(<span class="at">cost_complexity =</span> <span class="fu">tune</span>(),</span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">min_n =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a>                parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">&quot;rpart&quot;</span>,</span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">times =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a>                parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a><span class="co">#create recipe that codes categorical variables as dummy variables</span></span>
<span id="cb127-23"><a href="#cb127-23" aria-hidden="true" tabindex="-1"></a>BT_rec <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(total_points <span class="sc">~</span> ., <span class="at">data =</span> train_data) <span class="sc">%&gt;%</span></span>
<span id="cb127-24"><a href="#cb127-24" aria-hidden="true" tabindex="-1"></a>          <span class="fu">step_string2factor</span>(<span class="fu">all_nominal</span>())</span></code></pre></div>
<hr />
</div>
<div id="workflow-definition-3" class="section level3">
<h3>2. Workflow Definition</h3>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co">#define workflow for tree</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>BT_wflow <span class="ot">&lt;-</span> workflows<span class="sc">::</span><span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>               workflows<span class="sc">::</span><span class="fu">add_model</span>(bag_tree_mod) <span class="sc">%&gt;%</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>               workflows<span class="sc">::</span><span class="fu">add_recipe</span>(BT_rec)</span></code></pre></div>
<hr />
</div>
<div id="tuning-grid-specification-3" class="section level3">
<h3>3. Tuning Grid Specification</h3>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co">#tuning grid specification</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>tree_grid <span class="ot">&lt;-</span> dials<span class="sc">::</span><span class="fu">grid_regular</span>(<span class="fu">cost_complexity</span>(),</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">tree_depth</span>(),</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">min_n</span>(),</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">levels =</span> <span class="dv">5</span>)</span></code></pre></div>
<hr />
</div>
<div id="tuning-using-cross-validation-and-the-tune_grid-function-3" class="section level3">
<h3>4. Tuning Using Cross-Validation and the <code>tune_grid()</code> function</h3>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co">#tune the model with previously specified cross-validation and RMSE as target metric</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>BT_res <span class="ot">&lt;-</span> baguette<span class="sc">::</span><span class="fu">bag_tree</span>(<span class="at">cost_complexity =</span> <span class="fu">tune</span>(),</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">min_n =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>          parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">&quot;rpart&quot;</span>,</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">times =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>          parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>          tune<span class="sc">::</span><span class="fu">tune_grid</span>(<span class="at">preprocessor =</span> BT_rec,</span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">resamples =</span> data_bootstrap,</span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">grid =</span> tree_grid,</span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse))</span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a><span class="co">#collect metrics</span></span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a>BT_res <span class="sc">%&gt;%</span> workflowsets<span class="sc">::</span><span class="fu">collect_metrics</span>()</span></code></pre></div>
<pre><code>## # A tibble: 125 x 9
##    cost_complexity tree_depth min_n .metric .estimator  mean     n std_err
##              &lt;dbl&gt;      &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1    0.0000000001          1     2 rmse    standard    15.5    10   0.409
##  2    0.0000000178          1     2 rmse    standard    15.5    10   0.377
##  3    0.00000316            1     2 rmse    standard    15.6    10   0.393
##  4    0.000562              1     2 rmse    standard    15.6    10   0.351
##  5    0.1                   1     2 rmse    standard    15.5    10   0.301
##  6    0.0000000001          4     2 rmse    standard    15.2    10   0.726
##  7    0.0000000178          4     2 rmse    standard    15.0    10   0.508
##  8    0.00000316            4     2 rmse    standard    14.8    10   0.659
##  9    0.000562              4     2 rmse    standard    15.1    10   0.541
## 10    0.1                   4     2 rmse    standard    14.9    10   0.395
## # ... with 115 more rows, and 1 more variable: .config &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co">#default visualization</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>BT_auto_plot <span class="ot">&lt;-</span> BT_res <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>BT_auto_plot</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co">#more detailed plot</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>BT_det_plot <span class="ot">&lt;-</span> BT_res <span class="sc">%&gt;%</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>                    workflowsets<span class="sc">::</span><span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">tree_depth =</span> <span class="fu">factor</span>(tree_depth)) <span class="sc">%&gt;%</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>                    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(cost_complexity, mean, <span class="at">color =</span> tree_depth)) <span class="sc">+</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">facet_wrap</span>(<span class="sc">~</span> .metric, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">nrow =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>()) <span class="sc">+</span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="at">begin =</span> <span class="fl">0.9</span>, <span class="at">end =</span> <span class="dv">0</span>)</span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>BT_det_plot</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-22-2.png" width="672" /></p>
<hr />
</div>
<div id="identify-best-model-3" class="section level3">
<h3>5. Identify Best Model</h3>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co">#select the BT model with the lowest rmse</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>BT_lowest_rmse <span class="ot">&lt;-</span> BT_res <span class="sc">%&gt;%</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>                        tune<span class="sc">::</span><span class="fu">select_best</span>(<span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="co">#finalize the workflow by using the selected BT model</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>best_BT_wflow <span class="ot">&lt;-</span> BT_wflow <span class="sc">%&gt;%</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>                      tune<span class="sc">::</span><span class="fu">finalize_workflow</span>(BT_lowest_rmse)</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>best_BT_wflow</span></code></pre></div>
<pre><code>## == Workflow ====================================================================
## Preprocessor: Recipe
## Model: bag_tree()
## 
## -- Preprocessor ----------------------------------------------------------------
## 1 Recipe Step
## 
## * step_string2factor()
## 
## -- Model -----------------------------------------------------------------------
## Bagged Decision Tree Model Specification (regression)
## 
## Main Arguments:
##   cost_complexity = 0.0000000001
##   tree_depth = 4
##   min_n = 21
## 
## Engine-Specific Arguments:
##   times = 10
## 
## Computational engine: rpart</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co">#one last fit on the training data</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>best_BT_fit <span class="ot">&lt;-</span> best_BT_wflow <span class="sc">%&gt;%</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>                    parsnip<span class="sc">::</span><span class="fu">fit</span>(<span class="at">data =</span> train_data)</span></code></pre></div>
<hr />
</div>
<div id="model-evaluation-3" class="section level3">
<h3>6. Model evaluation</h3>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co">#extract model from final fit</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>x_BT <span class="ot">&lt;-</span> best_BT_fit<span class="sc">$</span>fit<span class="sc">$</span>fit<span class="sc">$</span>fit</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="co">#vip package doesn&#39;t support BT</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="co">#find predictions and intervals</span></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>BT_resid <span class="ot">&lt;-</span> best_BT_fit <span class="sc">%&gt;%</span></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>                  broom.mixed<span class="sc">::</span><span class="fu">augment</span>(<span class="at">new_data =</span> train_data) <span class="sc">%&gt;%</span></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">select</span>(.pred, total_points) <span class="sc">%&gt;%</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">.resid =</span> .pred <span class="sc">-</span> total_points)</span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a><span class="co">#plot model predictions from tuned model versus actual outcomes</span></span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a><span class="co">#geom_abline draws a 45 degree line, along which the results should fall</span></span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a>BT_pred_act <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(BT_resid, <span class="fu">aes</span>(<span class="at">x =</span> .pred, <span class="at">y =</span> total_points)) <span class="sc">+</span></span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Bagged Tree Fit: Predicted vs. Actual Total Points&quot;</span>,</span>
<span id="cb137-18"><a href="#cb137-18" aria-hidden="true" tabindex="-1"></a>                              <span class="at">x =</span> <span class="st">&quot;Predicted Total Points)&quot;</span>,</span>
<span id="cb137-19"><a href="#cb137-19" aria-hidden="true" tabindex="-1"></a>                              <span class="at">y =</span> <span class="st">&quot;Actual Total Points&quot;</span>)</span>
<span id="cb137-20"><a href="#cb137-20" aria-hidden="true" tabindex="-1"></a>BT_pred_act</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot model with residuals</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="co">#the geom_hline plots a straight horizontal line along which the results should fall</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>BT_resids <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(BT_resid, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(<span class="fu">row.names</span>(BT_resid)), <span class="at">y =</span> .resid))<span class="sc">+</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Bagged Tree Fit: Residuals&quot;</span>,</span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">x =</span> <span class="st">&quot;Observation Number&quot;</span>,</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">y =</span> <span class="st">&quot;Residual&quot;</span>)</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>BT_resids</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-24-2.png" width="672" /></p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot model fit vs residuals</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="co">#the geom_hline plots a straight horizontal line along which the results fall</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>BT_pred_resid <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(BT_resid, <span class="fu">aes</span>(<span class="at">x =</span> .pred, <span class="at">y =</span> .resid))<span class="sc">+</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Bagged Tree Fit: Residuals vs Fitted Total Points&quot;</span>,</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>                                <span class="at">x =</span> <span class="st">&quot;Predicted Total Points&quot;</span>,</span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>                                <span class="at">y =</span> <span class="st">&quot;Residual&quot;</span>)</span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>BT_pred_resid</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-24-3.png" width="672" /></p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co">#print model performance</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="co">#print 10 best performing hyperparameter sets</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>BT_res <span class="sc">%&gt;%</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">show_best</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">rmse =</span> mean, std_err, cost_complexity) <span class="sc">%&gt;%</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">rmse =</span> <span class="fu">round</span>(rmse, <span class="dv">3</span>),</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">std_err =</span> <span class="fu">round</span>(std_err, <span class="dv">4</span>),</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">cost_complexity =</span> scales<span class="sc">::</span><span class="fu">scientific</span>(cost_complexity))</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##     rmse std_err cost_complexity
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;          
##  1  14.2   0.678 1.00e-10       
##  2  14.3   0.746 1.00e-10       
##  3  14.3   0.652 3.16e-06       
##  4  14.4   0.499 3.16e-06       
##  5  14.4   0.666 1.78e-08       
##  6  14.4   0.522 1.00e-10       
##  7  14.4   0.605 1.78e-08       
##  8  14.4   0.666 5.62e-04       
##  9  14.4   0.676 5.62e-04       
## 10  14.4   0.666 1.00e-10</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co">#print the best model performance</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>BT_performance <span class="ot">&lt;-</span> BT_res <span class="sc">%&gt;%</span> tune<span class="sc">::</span><span class="fu">show_best</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(BT_performance)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 9
##   cost_complexity tree_depth min_n .metric .estimator  mean     n std_err
##             &lt;dbl&gt;      &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1    0.0000000001          4    21 rmse    standard    14.2    10   0.678
## # ... with 1 more variable: .config &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co">#compare model performance to null model</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>BT_RMSE <span class="ot">&lt;-</span> BT_res <span class="sc">%&gt;%</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>                tune<span class="sc">::</span><span class="fu">show_best</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">transmute</span>(</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">rmse =</span> <span class="fu">round</span>(mean, <span class="dv">3</span>),</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">SE =</span> <span class="fu">round</span>(std_err, <span class="dv">4</span>),</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">model =</span> <span class="st">&quot;Bagged Tree&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>               dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(RF_RMSE)</span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>BT_RMSE</span></code></pre></div>
<pre><code>## # A tibble: 5 x 3
##    rmse    SE model       
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       
## 1  14.2 0.678 Bagged Tree 
## 2  14.5 0.41  RF          
## 3  13.0 0.373 LASSO       
## 4  14.5 0.422 Tree        
## 5  23.5 0     Null - Train</code></pre>
<hr />
</div>
</div>
<div id="model-selection-and-evaluation" class="section level2">
<h2>Model Selection and Evaluation</h2>
<p>Based on the RMSE output above, the LASSO model has the lowest RMSE and therefore is the most appropriate model in this case. The RF and Tree models are virtually identical in their performance, but all three models are an improvement over the null model. It is worth noting that none of these models actually fit the data well - suggesting the predictor variables included in this dataset aren’t all that useful in predicting the desired outcome (e.g. body temperature in suspected flu patients).</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co">#fit lasso model to training set but evaluate on the test data</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>lasso_fit_test <span class="ot">&lt;-</span> best_lasso_wflow <span class="sc">%&gt;%</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>                    tune<span class="sc">::</span><span class="fu">last_fit</span>(<span class="at">split =</span> data_split)</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="co">#compare test performance against training performance</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>lasso_rmse_test <span class="ot">&lt;-</span> <span class="fu">collect_metrics</span>(lasso_fit_test) <span class="sc">%&gt;%</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">rmse =</span> .estimate) <span class="sc">%&gt;%</span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">data =</span> <span class="st">&quot;test&quot;</span>)</span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>lasso_comp <span class="ot">&lt;-</span> lasso_RMSE <span class="sc">%&gt;%</span></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">filter</span>(model <span class="sc">==</span> <span class="st">&quot;LASSO&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">transmute</span>(rmse, <span class="at">data =</span> <span class="st">&quot;train&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(lasso_rmse_test) <span class="sc">%&gt;%</span></span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="sc">-</span><span class="dv">3</span>) <span class="co">#don&#39;t know why the third row shows up</span></span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a>lasso_comp</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##    rmse data 
##   &lt;dbl&gt; &lt;chr&gt;
## 1  13.0 train
## 2  13.7 test</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co">#RMSEs are essentially identical --&gt; what we want (suggests we might&#39;ve avoided overfitting)</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="co">#find predictions and intervals</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>lasso_resid_fit <span class="ot">&lt;-</span> lasso_fit_test <span class="sc">%&gt;%</span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>                  broom.mixed<span class="sc">::</span><span class="fu">augment</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">select</span>(.pred, total_points) <span class="sc">%&gt;%</span></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">.resid =</span> .pred <span class="sc">-</span> total_points)</span></code></pre></div>
<pre><code>## Adding missing grouping variables: `race_number`</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot model predictions from tuned model versus actual outcomes</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="co">#geom_hline plots a 45 degree line, along which the results should fall</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(lasso_resid_fit, <span class="fu">aes</span>(<span class="at">x =</span> .pred, <span class="at">y =</span> total_points)) <span class="sc">+</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;LASSO fit: Predicted vs. Actual Total Points&quot;</span>,</span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;Predicted Total Points&quot;</span>,</span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Actual Total Points&quot;</span>)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot model with residuals</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="co">#the geom_hline plots a straight horizontal line along which the results should fall</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(lasso_resid_fit, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(<span class="fu">row.names</span>(lasso_resid_fit)), <span class="at">y =</span> .resid))<span class="sc">+</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Lasso Test Fit: Residuals&quot;</span>,</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;Observation Number&quot;</span>,</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Residual&quot;</span>)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-25-2.png" width="672" /></p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot model fit vs residuals</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="co">#the geom_hline plots a straight horizontal line along which the results fall</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(lasso_resid_fit, <span class="fu">aes</span>(<span class="at">x =</span> .pred, <span class="at">y =</span> .resid))<span class="sc">+</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;LASSO Test Fit: Residuals vs Fitted Total Points&quot;</span>,</span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;Fitted Total Points&quot;</span>,</span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Residual&quot;</span>)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-25-3.png" width="672" /></p>
<hr />
</div>
<div id="overall-conclusion" class="section level2">
<h2>Overall Conclusion</h2>
<p>The LASSO model fits the data best. The model using both training and testing data performs better than the other possible models. There’s certainly plenty of opportunities for further exploration or tuning. There’s an underlying time-trend series component to this data set, so cross-validation may not be the most appropriate. I would be interested to come back to this analysis after better understanding time series.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
